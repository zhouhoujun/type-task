!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("tslib"),require("@ts-ioc/core"),require("rxjs/BehaviorSubject"),require("rxjs/add/operator/filter"),require("@ts-ioc/aop"),require("@ts-ioc/logs")):"function"==typeof define&&define.amd?define(["tslib","@ts-ioc/core","rxjs/BehaviorSubject","rxjs/add/operator/filter","@ts-ioc/aop","@ts-ioc/logs"],e):(t.core=t.core||{},t.core.umd=t.core.umd||{},t.core.umd.js=e(t.tslib_1,t.core_1,t.BehaviorSubject_1,t.filter,t.aop_1,t.logs_1))}(this,function(u,l,r,t,o,a){"use strict";u=u&&u.hasOwnProperty("default")?u.default:u,l=l&&l.hasOwnProperty("default")?l.default:l,r=r&&r.hasOwnProperty("default")?r.default:r,t=t&&t.hasOwnProperty("default")?t.default:t,o=o&&o.hasOwnProperty("default")?o.default:o,a=a&&a.hasOwnProperty("default")?a.default:a;"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function n(t,e){return t(e={exports:{}},e.exports),e.exports}var s=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.TaskContainerToken=new l.InjectToken("__TASK_TaskContainer")});e(s);s.TaskContainerToken;var i=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(t){return e.call(this,"ActivityBuilder",t)||this}return u.__extends(t,e),t.classAnnations={name:"InjectAcitityBuilderToken",params:{constructor:["desc"]}},t}(l.Registration);e.InjectAcitityBuilderToken=n,e.ActivityBuilderToken=new l.InjectToken("__TASK_Builder")});e(i);i.InjectAcitityBuilderToken,i.ActivityBuilderToken;var d=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.isActivityType=function(t,e){return void 0===e&&(e=!0),!(!t||l.isString(t)||!l.isToken(t)&&(!l.isMetadataObject(t)||e&&!t.task&&!t.bootstrap))}});e(d);d.isActivityType;var c=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(t){return e.call(this,"Activity",t)||this}return u.__extends(t,e),t.classAnnations={name:"InjectAcitityToken",params:{constructor:["desc"]}},t}(l.Registration);e.InjectAcitityToken=n,e.ActivityToken=new n("")});e(c);c.InjectAcitityToken,c.ActivityToken;var p=n(function(t,e){function n(e,n,i,r,o){return l.createClassDecorator("Task",function(t){r&&r(t),t.next({match:function(t){return t&&(l.isString(t)||l.isObject(t)&&t instanceof l.Registration)},setMetadata:function(t,e){l.isString(e)?t.name=e:t.provide=e}}),t.next({match:function(t){return l.isString(t)||l.isToken(t)},setMetadata:function(t,e){l.isString(e)?t.name=e:t.builder=e}}),t.next({match:function(t){return l.isString(t)},setMetadata:function(t,e){t.name=e}})},function(t){return o&&(t=o(t)),!t.name&&l.isClass(t.type)&&(/^[a-z]$/.test(t.type.name)&&t.type.classAnnations?t.name=t.type.classAnnations.name:t.name=t.type.name),t.provide=t.provide||i,t.alias=t.alias||t.name,t.decorType=e,t.builder||(t.builder=n),t})}Object.defineProperty(e,"__esModule",{value:!0}),e.createTaskDecorator=n,e.Task=n("Task",i.ActivityBuilderToken,c.ActivityToken)});e(p);p.createTaskDecorator,p.Task;var f=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.Runner=l.createClassDecorator("Runner")});e(f);f.Runner;var h=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),u.__exportStar(p,e),u.__exportStar(f,e)});e(h);var v=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(t){return e.call(this,"ActivityContext",t)||this}return u.__extends(t,e),t.classAnnations={name:"InjectContextToken",params:{constructor:["desc"]}},t}(l.Registration);e.InjectContextToken=n,e.ContextToken=new n("")});e(v);v.InjectContextToken,v.ContextToken;var y=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){}return t.prototype.run=function(t,e){return Promise.resolve(t)},t.classAnnations={name:"Activity",params:{constructor:[],run:["data","execute"]}},u.__decorate([l.Inject(v.ContextToken),u.__metadata("design:type",Object)],t.prototype,"context",void 0),u.__decorate([h.Task,u.__metadata("design:paramtypes",[])],t)}();e.Activity=n});e(y);y.Activity;var _=n(function(t,e){t.exports=function(s,c){function t(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function e(t,e){return t(e={exports:{}},e.exports),e.exports}s=s&&s.hasOwnProperty("default")?s.default:s,c=c&&c.hasOwnProperty("default")?c.default:c;var i=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(t){return e.call(this,"DI_ModuleBuilder",t)||this}return s.__extends(t,e),t.classAnnations={name:"InjectModuleBuilder",params:{constructor:["desc"]}},t}(c.Registration);e.InjectModuleBuilder=n,e.ModuleBuilderToken=new n("")});t(i),i.InjectModuleBuilder,i.ModuleBuilderToken;var o=e(function(t,e){function n(n,i,r,e,o){return c.createClassDecorator("DIModule",function(t){e&&e(t),t.next({match:function(t){return t&&(c.isString(t)||c.isObject(t)&&t instanceof c.Registration)},setMetadata:function(t,e){c.isString(e)?t.name=e:t.provide=e}}),t.next({match:function(t){return c.isString(t)||c.isToken(t)},setMetadata:function(t,e){c.isString(e)?t.name=e:t.builder=e}}),t.next({match:function(t){return c.isString(t)||c.isBoolean(t)},setMetadata:function(t,e){c.isString(e)?t.name=e:c.isBoolean(e)&&(t.singleton=e)}})},function(t){if(o&&(t=o(t)),!t.name&&c.isClass(t.type)){var e=/^[a-z]$/.test(t.type.name);e&&t.type.classAnnations?t.name=t.type.classAnnations.name:t.name=t.type.name}return t.provide=t.provide||r,t.alias=t.alias||t.name,t.decorType=n,t.builder||(t.builder=i),t})}Object.defineProperty(e,"__esModule",{value:!0}),e.createDIModuleDecorator=n,e.DIModule=n("module",i.ModuleBuilderToken)});t(o),o.createDIModuleDecorator,o.DIModule;var r=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(t){return e.call(this,"DI_Application",t)||this}return s.__extends(t,e),t.classAnnations={name:"InjectApplicationToken",params:{constructor:["desc"]}},t}(c.Registration);e.InjectApplicationToken=n,e.ApplicationToken=new n("")});t(r),r.InjectApplicationToken,r.ApplicationToken;var n=e(function(t,e){function n(t,e,n,i,r){return o.createDIModuleDecorator(t,e,n,i,r)}Object.defineProperty(e,"__esModule",{value:!0}),e.createBootstrapDecorator=n,e.Bootstrap=n("bootstrap",i.ModuleBuilderToken,r.ApplicationToken)});t(n),n.createBootstrapDecorator,n.Bootstrap;var a=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),s.__exportStar(o,e),s.__exportStar(n,e)});t(a);var u=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.ApplicationBuilderToken=new c.InjectToken("DI_AppBuilder"),e.ApplicationBuilderFactoryToken=new c.InjectToken("DI_AppBuilder_Factory")});t(u),u.ApplicationBuilderToken,u.ApplicationBuilderFactoryToken;var l=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){}return(e=t).prototype.build=function(r,o){return s.__awaiter(this,void 0,void 0,function(){var e,n,i;return s.__generator(this,function(t){switch(t.label){case 0:return e=this.getConfigure(r),[4,(n=this.getBuilder(e)).createInstance(c.isToken(r)?r:null,e,o)];case 1:return i=t.sent(),[4,n.buildStrategy(i,e)];case 2:return t.sent(),[2,i]}})})},t.prototype.buildStrategy=function(e,t){return s.__awaiter(this,void 0,void 0,function(){return s.__generator(this,function(t){return[2,e]})})},t.prototype.getBuilder=function(t){var e;if(t.builder)e=this.getBuilderViaConfig(t.builder);else{var n=this.getBootstrapToken(t);n&&(e=this.getBuilderViaToken(n))}return e||this},t.prototype.getDecorator=function(){return a.DIModule.toString()},t.prototype.getConfigure=function(t){var e;if(c.isClass(t))e=this.getMetaConfig(t);else if(c.isToken(t)){var n=this.container.getTokenImpl(t);c.isClass(n)&&(e=this.getMetaConfig(n))}else{e=t;var i=this.getBootstrapToken(e),r=c.isClass(i)?i:this.container.getTokenImpl(i);c.isClass(r)&&(e=c.lang.assign({},this.getMetaConfig(r),e||{}))}return e||{}},t.prototype.createInstance=function(n,i,t){return s.__awaiter(this,void 0,void 0,function(){var e;return s.__generator(this,function(t){switch(t.label){case 0:if(!(e=this.getBootstrapToken(i,n)))throw new Error("not find bootstrap token.");return[4,this.registerDepdences(i)];case 1:return t.sent(),c.isClass(e)&&(this.container.has(e)||this.container.register(e)),[2,this.container.resolve(e)]}})})},t.prototype.getBootstrapToken=function(t,e){return t.bootstrap||e},t.prototype.getBuilderViaConfig=function(t){return c.isToken(t)?this.container.resolve(t):t instanceof e?t:null},t.prototype.getBuilderViaToken=function(t){if(c.isToken(t)){var e=c.isClass(t)?t:this.container.getTokenImpl(t);if(e){var n=c.lang.first(c.getTypeMetadata(this.getDecorator(),e));if(n&&n.builder)return c.isToken(n.builder)?this.container.resolve(n.builder):n.builder}}return null},t.prototype.getMetaConfig=function(t){var e=this.getDecorator();if(c.hasClassMetadata(e,t)){var n=c.getTypeMetadata(e,t);if(n&&n.length){var i=n[0];return i.bootstrap=i.bootstrap||t,c.lang.omit(i,"builder")}}return null},t.prototype.registerDepdences=function(a){return s.__awaiter(this,void 0,void 0,function(){var e,o,n,i=this;return s.__generator(this,function(t){switch(t.label){case 0:return c.isArray(a.imports)&&a.imports.length?(e=this.container.get(c.ContainerBuilderToken),o=this.getDecorator(),[4,e.loader.loadTypes(a.imports,function(t){return c.hasOwnClassMetadata(c.IocExt,t)||c.hasOwnClassMetadata(o,t)})]):[3,3];case 1:return t.sent().forEach(function(r){return s.__awaiter(i,void 0,void 0,function(){var e,n,i=this;return s.__generator(this,function(t){switch(t.label){case 0:return this.container.has(u.ApplicationBuilderFactoryToken)&&c.hasClassMetadata(o,r)?(e=c.lang.first(c.getTypeMetadata(o,r)))?[4,(n=this.container.get(u.ApplicationBuilderFactoryToken)).build(r)]:[3,2]:[3,3];case 1:t.sent(),e.exports&&e.exports.length&&e.exports.forEach(function(t){i.container.bindProvider(t,function(){return n.getContainer().resolve(t)})}),e.providers&&e.providers.length&&this.bindProvider(this.container,a.providers),this.container.bindProvider(r,function(){return n.build(r)}),t.label=2;case 2:return[3,4];case 3:this.container.register(r),t.label=4;case 4:return[2]}})})}),[4,(n=this.container).loadModule.apply(n,a.imports)];case 2:t.sent(),t.label=3;case 3:return c.isArray(a.providers)&&a.providers.length&&this.bindProvider(this.container,a.providers),[2,this.container]}})})},t.prototype.bindProvider=function(r,t){t.forEach(function(n,t){if(!c.isUndefined(n)&&!c.isNull(n))if(c.isProviderMap(n))n.forEach(function(t,e){r.bindProvider(t,e)});else if(n instanceof c.Provider)r.bindProvider(n.type,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return n.resolve.apply(n,[r].concat(t))});else if(c.isClass(n))r.has(n)||r.register(n);else if(c.isBaseObject(n)){var e=n,i=!1;c.isToken(e.provide)?(c.isArray(e.deps)&&e.deps.length&&e.deps.forEach(function(t){c.isClass(t)&&!r.has(t)&&r.register(t)}),c.isUndefined(e.useValue)?c.isClass(e.useClass)?(r.has(e.useClass)||r.register(e.useClass),r.bindProvider(e.provide,e.useClass)):c.isFunction(e.useFactory)?r.bindProvider(e.provide,function(){var t=[];return c.isArray(e.deps)&&e.deps.length&&(t=e.deps.map(function(t){return c.isClass(t)?r.get(t):t})),e.useFactory.apply(e,t)}):c.isToken(e.useExisting)?r.has(e.useExisting)?r.bindProvider(e.provide,e.useExisting):console.log("has not register:",e.useExisting):i=!0:r.bindProvider(e.provide,function(){return e.useValue})):i=!0,i&&c.lang.forIn(n,function(t,e){c.isUndefined(t)||(c.isClass(t)?r.bindProvider(e,t):c.isFunction(t)||c.isString(t)?r.bindProvider(e,function(){return t}):r.bindProvider(e,t))})}else c.isFunction(n)&&r.bindProvider(name,function(){return n})})},t.classAnnations={name:"ModuleBuilder",params:{constructor:[],build:["token","data"],buildStrategy:["instance","config"],getBuilder:["config"],getDecorator:[],getConfigure:["token"],createInstance:["token","cfg","data"],getBootstrapToken:["cfg","token"],getBuilderViaConfig:["builder"],getBuilderViaToken:["mdl"],getMetaConfig:["bootModule"],registerDepdences:["config"],bindProvider:["container","providers"]}},s.__decorate([c.Inject(c.ContainerToken),s.__metadata("design:type",Object)],t.prototype,"container",void 0),t=e=s.__decorate([c.Injectable(i.ModuleBuilderToken),s.__metadata("design:paramtypes",[])],t);var e}();e.ModuleBuilder=n});t(l),l.ModuleBuilder;var d=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.container=t}return t.prototype.setup=function(){var t=this.container,e=t.get(c.LifeScopeToken);e.registerDecorator(a.DIModule,c.CoreActions.bindProvider,c.CoreActions.cache,c.CoreActions.componentBeforeInit,c.CoreActions.componentInit,c.CoreActions.componentAfterInit),e.registerDecorator(a.Bootstrap,c.CoreActions.bindProvider,c.CoreActions.cache,c.CoreActions.componentBeforeInit,c.CoreActions.componentInit,c.CoreActions.componentAfterInit),t.register(l.ModuleBuilder),t.register(p.ApplicationBuilder)},t.classAnnations={name:"BootstrapModule",params:{constructor:["container"],setup:[]}},t=s.__decorate([c.IocExt("setup"),s.__param(0,c.Inject(c.ContainerToken)),s.__metadata("design:paramtypes",[Object])],t)}();e.BootstrapModule=n});t(d),d.BootstrapModule;var p=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.baseURL=t,this.usedModules=[],this.customRegs=[]}return t.prototype.getContainer=function(){return this.container||(this.container=this.getContainerBuilder().create()),this.container},t.prototype.setContainer=function(t){return t&&(this.container=t,this.builder=t.get(c.ContainerBuilderToken)),this},t.prototype.getContainerBuilder=function(){return this.builder||(this.builder=this.createContainerBuilder()),this.builder},t.prototype.setContainerBuilder=function(t){return this.builder=t,this.container=null,this},t.prototype.getModuleBuilder=function(){return this.moduleBuilder||(this.moduleBuilder=this.createModuleBuilder()),this.moduleBuilder},t.prototype.setModuleBuilder=function(t){return this.moduleBuilder=t,this},t.prototype.useConfiguration=function(t){var e;this.globalConfig||(this.globalConfig=Promise.resolve(this.getDefaultConfig()));var n=this.getContainerBuilder();return c.isString(t)?e=n.loader.load([t]).then(function(t){return t.length?t[0]:null}):t&&(e=Promise.resolve(t)),e&&(this.globalConfig=this.globalConfig.then(function(n){return e.then(function(t){var e=t.default?t.default:t;return n=c.lang.assign(n||{},e||{})})})),this},t.prototype.use=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this.usedModules=this.usedModules.concat(t),this},t.prototype.registerModules=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this.customRegs=this.customRegs.concat(t),this},t.prototype.bootstrap=function(i){return s.__awaiter(this,void 0,void 0,function(){var e,n;return s.__generator(this,function(t){switch(t.label){case 0:return[4,this.build(i)];case 1:return(e=t.sent()).config&&c.isToken(i)&&e.config.bootstrap!==i&&(!this.container.has(i)&&c.isClass(i)&&this.container.register(i),this.container.has(i)&&(n=this.container.resolve(i))),n=n||e,c.isFunction(n.onStart)?[4,Promise.resolve(n.onStart(e))]:[3,3];case 2:t.sent(),t.label=3;case 3:return c.isFunction(n.onStarted)&&n.onStarted(e),[2,n]}})})},t.prototype.build=function(r){return s.__awaiter(this,void 0,void 0,function(){var e,n,i;return s.__generator(this,function(t){switch(t.label){case 0:return e=this.getContainer(),[4,this.registerExts(e)];case 1:return t.sent(),n=this.getModuleBuilder(),[4,this.mergeConfigure(n.getConfigure(r))];case 2:return i=t.sent(),this.bindConfiguration(e,i),[4,this.initContainer(i,e)];case 3:return t.sent(),i.bootstrap||(i.bootstrap=c.isToken(r)?r:null),[4,this.createInstance(n,i)];case 4:return[2,t.sent()]}})})},t.prototype.createInstance=function(t,e){return t.build(e)},t.prototype.createModuleBuilder=function(){return this.getContainer().get(i.ModuleBuilderToken)},t.prototype.createContainerBuilder=function(){return new c.DefaultContainerBuilder},t.prototype.registerExts=function(i){return s.__awaiter(this,void 0,void 0,function(){var e,n=this;return s.__generator(this,function(t){switch(t.label){case 0:return this.container.bindProvider(u.ApplicationBuilderToken,this),this.container.bindProvider(u.ApplicationBuilderFactoryToken,function(){return n.createContainerBuilder()}),i.has(d.BootstrapModule)||i.register(d.BootstrapModule),this.usedModules.length?(e=this.usedModules,this.usedModules=[],[4,i.loadModule.apply(i,[i].concat(e))]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2,i]}})})},t.prototype.initContainer=function(i,r){return s.__awaiter(this,void 0,void 0,function(){var e,n=this;return s.__generator(this,function(t){switch(t.label){case 0:return this.customRegs.length?(e=this.customRegs,this.customRegs=[],[4,Promise.all(e.map(function(t){return t(r,i,n)}))]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2,r]}})})},t.prototype.bindConfiguration=function(t,e){this.baseURL&&(e.baseURL=this.baseURL)},t.prototype.mergeConfigure=function(n){return s.__awaiter(this,void 0,void 0,function(){var e;return s.__generator(this,function(t){switch(t.label){case 0:return this.globalConfig||this.useConfiguration(),[4,this.globalConfig];case 1:return e=t.sent(),[2,c.lang.assign({},e,n)]}})})},t.prototype.getDefaultConfig=function(){return{debug:!1}},t.classAnnations={name:"ApplicationBuilder",params:{constructor:["baseURL"],getContainer:[],setContainer:["container"],getContainerBuilder:[],setContainerBuilder:["builder"],getModuleBuilder:[],setModuleBuilder:["builder"],useConfiguration:["config"],use:["modules"],registerModules:["moduleRegs"],bootstrap:["token"],build:["token"],createInstance:["builder","config"],createModuleBuilder:[],createContainerBuilder:[],registerExts:["container"],initContainer:["config","container"],bindConfiguration:["container","config"],mergeConfigure:["cfg"],getDefaultConfig:[]}},t}();e.ApplicationBuilder=n});return t(p),p.ApplicationBuilder,t(e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),s.__exportStar(a,e),s.__exportStar(p,e),s.__exportStar(r,e),s.__exportStar(u,e),s.__exportStar(i,e),s.__exportStar(l,e),s.__exportStar(d,e)}))}(u,l)});e(_);var g=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(o){function t(){return o.call(this)||this}return u.__extends(t,o),t.prototype.build=function(t,e){return o.prototype.build.call(this,t,e)},t.prototype.createInstance=function(n,i,r){return u.__awaiter(this,void 0,void 0,function(){var e;return u.__generator(this,function(t){switch(t.label){case 0:return[4,o.prototype.createInstance.call(this,n,i)];case 1:return(e=t.sent())&&e instanceof y.Activity?[3,3]:(i.task=this.getDefaultAcitvity(),console.log("try load default activity:",l.getClassName(i.task)),[4,this.build(i,r)]);case 2:e=t.sent(),t.label=3;case 3:return e.id=r,l.isFunction(e.onTaskInit)&&e.onTaskInit(i),[2,e]}})})},t.prototype.buildStrategy=function(e,n){return u.__awaiter(this,void 0,void 0,function(){return u.__generator(this,function(t){return n.name&&(e.name=n.name),e.config=n,[2,e]})})},t.prototype.getDecorator=function(){return h.Task.toString()},t.prototype.getDefaultAcitvity=function(){return y.Activity},t.prototype.toExpression=function(e,n){return u.__awaiter(this,void 0,void 0,function(){return u.__generator(this,function(t){switch(t.label){case 0:return d.isActivityType(e)?[4,this.build(e,n.id)]:[3,2];case 1:return[2,t.sent()];case 2:return[2,e]}})})},t.prototype.toActivity=function(r,o,a,s,c){return u.__awaiter(this,void 0,void 0,function(){var e,n,i;return u.__generator(this,function(t){switch(t.label){case 0:return d.isActivityType(r,!c)?c?[4,this.build(l.isToken(r)?r:c(r),o.id)]:[3,2]:[3,5];case 1:return e=t.sent(),[3,4];case 2:return[4,this.build(r,o.id)];case 3:e=t.sent(),t.label=4;case 4:return[3,6];case 5:e=r,t.label=6;case 6:return a(e)?[2,e]:l.isString(e)?(n=e,[3,9]):[3,7];case 7:return[4,o.context.exec(o,e)];case 8:n=t.sent(),t.label=9;case 9:return i=s(n),c&&(i=c(i)),i?[4,this.build(i,o.id)]:[3,11];case 10:return e=t.sent(),[3,12];case 11:e=null,t.label=12;case 12:return[2,e]}})})},t.prototype.getBootstrapToken=function(t,e){var n=t.task||t.bootstrap||e;return l.isString(n)&&(n=this.traslateStrToken(n)),n},t.prototype.traslateStrToken=function(t){var e=new l.Registration(c.ActivityToken,t);return this.container.has(e)?e:t},t.classAnnations={name:"ActivityBuilder",params:{constructor:[],build:["task","uuid"],createInstance:["token","config","uuid"],buildStrategy:["activity","config"],getDecorator:[],getDefaultAcitvity:[],toExpression:["exptype","target"],toActivity:["exptype","target","isRightActivity","toConfig","valify"],getBootstrapToken:["cfg","token"],traslateStrToken:["token"]}},u.__decorate([l.Singleton(i.ActivityBuilderToken),u.__metadata("design:paramtypes",[])],t)}(_.ModuleBuilder);e.ActivityBuilder=n});e(g);g.ActivityBuilder;var b=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.UUIDToken=new l.InjectToken("uuid_factory");var n=function(){function t(){}return t.prototype.generate=function(){return this.randomS4()+this.randomS4()+"-"+this.randomS4()+"-"+this.randomS4()+"-"+this.randomS4()+"-"+this.randomS4()+this.randomS4()+this.randomS4()},t.prototype.randomS4=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},t.classAnnations={name:"RandomUUIDFactory",params:{constructor:[],generate:[],randomS4:[]}},u.__decorate([l.Singleton(e.UUIDToken),u.__metadata("design:paramtypes",[])],t)}();e.RandomUUIDFactory=n});e(b);b.UUIDToken,b.RandomUUIDFactory;var A=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n,i=function(e){function t(t){return e.call(this,"TaskRunner",t)||this}return u.__extends(t,e),t.classAnnations={name:"InjectTaskRunnerToken",params:{constructor:["desc"]}},t}(l.Registration);e.InjectTaskRunnerToken=i,e.TaskRunnerToken=new i(""),(n=e.RunState||(e.RunState={}))[n.init=0]="init",n[n.running=1]="running",n[n.pause=2]="pause",n[n.stop=3]="stop",n[n.complete=4]="complete"});e(A);A.InjectTaskRunnerToken,A.TaskRunnerToken,A.RunState;var k=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,n,i){this.activity=t,this.uuid=e,this.instance=n,this.activityBuilder=i,this._result=new r.BehaviorSubject(null),this.stateChanged=new r.BehaviorSubject(A.RunState.init)}return Object.defineProperty(t.prototype,"task",{get:function(){return this.activity},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"taskInstance",{get:function(){return this.instance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"result",{get:function(){return this._result.filter(function(t){return!t})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resultValue",{get:function(){return this._resultValue},enumerable:!0,configurable:!0}),t.prototype.onInit=function(){this.container.bindProvider(this.getUUID(),this)},t.prototype.getUUID=function(){return this.uuid||(this.instance&&this.instance.id?this.uuid=this.instance.id:l.isToken(this.activity)&&(this.uuid=this.createUUID()),this.uuid=this.uuid||this.createUUID()),this.uuid},t.prototype.getBuilder=function(){return this.activityBuilder||(this.activityBuilder=this.container.resolve(i.ActivityBuilderToken)),this.activityBuilder},t.prototype.getInstance=function(){return u.__awaiter(this,void 0,void 0,function(){var e;return u.__generator(this,function(t){switch(t.label){case 0:return this.instance?[3,2]:[4,(e=this).getBuilder().build(this.task,this.getUUID())];case 1:e.instance=t.sent(),t.label=2;case 2:return[2,this.instance]}})})},t.prototype.start=function(n){return u.__awaiter(this,void 0,void 0,function(){var e=this;return u.__generator(this,function(t){switch(t.label){case 0:return[4,this.getInstance()];case 1:return[2,t.sent().run(n).then(function(t){return e.state=A.RunState.complete,e.stateChanged.next(e.state),e._resultValue=t,e._result.next(t),t})]}})})},t.prototype.saveState=function(t){this._currState=t},t.prototype.stop=function(){this.state=A.RunState.stop,this.stateChanged.next(this.state)},t.prototype.pause=function(){this.state=A.RunState.pause,this.stateChanged.next(this.state)},t.prototype.createUUID=function(){return this.container.has(b.UUIDToken)||this.container.register(b.RandomUUIDFactory),this.container.get(b.UUIDToken).generate()},t.classAnnations={name:"TaskRunner",params:{constructor:["activity","uuid","instance","activityBuilder"],onInit:[],getUUID:[],getBuilder:[],getInstance:[],start:["data"],saveState:["state"],stop:[],pause:[],createUUID:[]}},u.__decorate([l.Inject(l.ContainerToken),u.__metadata("design:type",Object)],t.prototype,"container",void 0),u.__decorate([h.Runner(A.TaskRunnerToken),u.__metadata("design:paramtypes",[Object,String,Object,Object])],t)}();e.TaskRunner=n});e(k);k.TaskRunner;var T=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){}return t.prototype.getContainer=function(){return this.container},t.prototype.getTaskContiner=function(){return this.container.resolve(s.TaskContainerToken)},t.prototype.getRootPath=function(){return this.getTaskContiner().getRootPath()},t.prototype.getRunner=function(t,e,n,i){var r;return l.isToken(n)?r=this.container.resolve(n):n instanceof g.ActivityBuilder&&(r=n),this.container.resolve(A.TaskRunnerToken,{activity:t,uuid:e,instance:i,activityBuilder:r})},t.prototype.getEnvArgs=function(){return{}},t.prototype.to=function(t,e){return l.isFunction(t)?l.isClass(t)?t:t(this,e):t},t.prototype.exec=function(t,e,n){return l.isFunction(e)?e(t,n):l.isPromise(e)?e:e instanceof y.Activity?e.run(n,t):e instanceof k.TaskRunner?e.start(n):Promise.resolve(e)},t.prototype.isTask=function(t){return l.hasOwnClassMetadata(h.Task,t)},t.classAnnations={name:"Context",params:{constructor:[],getContainer:[],getTaskContiner:[],getRootPath:[],getRunner:["task","uuid","builder","instance"],getEnvArgs:[],to:["target","config"],exec:["target","expression","data"],isTask:["task"]}},u.__decorate([l.Inject(l.ContainerToken),u.__metadata("design:type",Object)],t.prototype,"container",void 0),u.__decorate([l.Singleton(v.ContextToken),u.__metadata("design:paramtypes",[])],t)}();e.Context=n});e(T);T.Context;var m=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),u.__exportStar(i,e),u.__exportStar(g,e),u.__exportStar(c,e),u.__exportStar(y,e),u.__exportStar(d,e),u.__exportStar(b,e),u.__exportStar(h,e),u.__exportStar(v,e),u.__exportStar(T,e),u.__exportStar(A,e),u.__exportStar(k,e)});e(m);var B=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){}return t.prototype.beforeRun=function(t){var e=this.getRunner(t.target);if(e)switch(e.saveState(t),e.state){case m.RunState.pause:throw new Error("workflow paused!");case m.RunState.stop:throw new Error("workflow stop!")}},t.prototype.afterRun=function(t){var e=this.getRunner(t.target);if(e)switch(e.saveState(t),e.state){case m.RunState.pause:throw new Error("workflow paused!");case m.RunState.stop:throw new Error("workflow stop!")}},t.prototype.getRunner=function(t){return t instanceof m.Activity&&t.id&&this.container.has(t.id)?this.container.resolve(t.id):null},t.classAnnations={name:"RunAspect",params:{constructor:[],beforeRun:["joinPoint"],afterRun:["joinPoint"],getRunner:["task"]}},u.__decorate([l.Inject(l.ContainerToken),u.__metadata("design:type",Object)],t.prototype,"container",void 0),u.__decorate([o.Before("execution(*.run)"),u.__metadata("design:type",Function),u.__metadata("design:paramtypes",[o.Joinpoint]),u.__metadata("design:returntype",void 0)],t.prototype,"beforeRun",null),u.__decorate([o.AfterReturning("execution(*.run)"),u.__metadata("design:type",Function),u.__metadata("design:paramtypes",[o.Joinpoint]),u.__metadata("design:returntype",void 0)],t.prototype,"afterRun",null),u.__decorate([o.Aspect({annotation:m.Task,singleton:!0}),u.__metadata("design:paramtypes",[])],t)}();e.RunAspect=n});e(B);B.RunAspect;var w=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),u.__exportStar(B,e)});e(w);var x=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.container=t}return t.prototype.setup=function(){var t=this.container,e=t.getLifeScope();e.registerDecorator(m.Runner,l.CoreActions.bindProvider,l.CoreActions.cache,l.CoreActions.componentBeforeInit,l.CoreActions.componentInit,l.CoreActions.componentAfterInit),e.registerDecorator(m.Task,l.CoreActions.bindProvider,l.CoreActions.cache,l.CoreActions.componentBeforeInit,l.CoreActions.componentInit,l.CoreActions.componentAfterInit),t.register(m.ActivityBuilder),t.register(m.TaskRunner),t.register(w.RunAspect),t.register(m.Activity)},t.classAnnations={name:"CoreModule",params:{constructor:["container"],setup:[]}},u.__decorate([l.IocExt("setup"),u.__param(0,l.Inject(l.ContainerToken)),u.__metadata("design:paramtypes",[Object])],t)}();e.CoreModule=n});e(x);x.CoreModule;var S=n(function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.DelayActivityToken=new m.InjectAcitityToken("delay"),n.DelayActivityBuilderToken=new m.InjectAcitityBuilderToken("delay");var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u.__extends(e,t),e.prototype.run=function(r){return u.__awaiter(this,void 0,void 0,function(){var e,n,i;return u.__generator(this,function(t){switch(t.label){case 0:return[4,this.context.exec(this,this.delay,r)];case 1:return e=t.sent(),n=new l.Defer,i=setTimeout(function(){n.resolve(r),clearTimeout(i)},e),[4,n.promise];case 2:return[2,t.sent()]}})})},e.classAnnations={name:"DelayActivity",params:{run:["data"]}},u.__decorate([m.Task(n.DelayActivityToken,n.DelayActivityBuilderToken)],e)}(m.Activity);n.DelayActivity=o;var e=function(r){function t(){return null!==r&&r.apply(this,arguments)||this}return u.__extends(t,r),t.prototype.buildStrategy=function(n,i){return u.__awaiter(this,void 0,void 0,function(){var e;return u.__generator(this,function(t){switch(t.label){case 0:return[4,r.prototype.buildStrategy.call(this,n,i)];case 1:return t.sent(),n instanceof o?(e=n,[4,this.toExpression(i.delay,n)]):[3,3];case 2:e.delay=t.sent(),t.label=3;case 3:return[2,n]}})})},t.classAnnations={name:"DelayActivityBuilder",params:{buildStrategy:["activity","config"]}},u.__decorate([l.Singleton(n.DelayActivityBuilderToken)],t)}(m.ActivityBuilder);n.DelayActivityBuilder=e});e(S);S.DelayActivityToken,S.DelayActivityBuilderToken,S.DelayActivity,S.DelayActivityBuilder;var C=n(function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.IntervalActivityToken=new m.InjectAcitityToken("interval"),n.IntervalActivityBuilderToken=new m.InjectAcitityBuilderToken("interval");var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u.__extends(e,t),e.prototype.run=function(r){return u.__awaiter(this,void 0,void 0,function(){var e,n,i=this;return u.__generator(this,function(t){switch(t.label){case 0:return[4,this.context.exec(this,this.interval,r)];case 1:return e=t.sent(),n=r,setInterval(function(){i.body.run(n)},e),[2,r]}})})},e.classAnnations={name:"IntervalActivity",params:{run:["data"]}},u.__decorate([m.Task(n.IntervalActivityToken,n.IntervalActivityBuilderToken)],e)}(m.Activity);n.IntervalActivity=a;var e=function(o){function t(){return null!==o&&o.apply(this,arguments)||this}return u.__extends(t,o),t.prototype.buildStrategy=function(i,r){return u.__awaiter(this,void 0,void 0,function(){var e,n;return u.__generator(this,function(t){switch(t.label){case 0:return[4,o.prototype.buildStrategy.call(this,i,r)];case 1:return t.sent(),i instanceof a?(e=i,[4,this.toExpression(r.interval,i)]):[3,4];case 2:return e.interval=t.sent(),n=i,[4,this.build(r.body,i.id)];case 3:n.body=t.sent(),t.label=4;case 4:return[2,i]}})})},t.classAnnations={name:"IntervalActivityBuilder",params:{buildStrategy:["activity","config"]}},u.__decorate([l.Singleton(n.IntervalActivityBuilderToken)],t)}(m.ActivityBuilder);n.IntervalActivityBuilder=e});e(C);C.IntervalActivityToken,C.IntervalActivityBuilderToken,C.IntervalActivity,C.IntervalActivityBuilder;var I=n(function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.DoWhileActivityToken=new m.InjectAcitityToken("dowhile"),n.DoWhileActivityBuilderToken=new m.InjectAcitityBuilderToken("delay");var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u.__extends(e,t),e.prototype.run=function(i){return u.__awaiter(this,void 0,void 0,function(){var e,n;return u.__generator(this,function(t){switch(t.label){case 0:return[4,this.body.run(i)];case 1:return e=t.sent(),[4,this.context.exec(this,this.condition,e)];case 2:n=t.sent(),t.label=3;case 3:return n?[4,this.body.run(e||i)]:[3,6];case 4:return e=t.sent(),[4,this.context.exec(this,this.condition,e)];case 5:return n=t.sent(),[3,3];case 6:return[2,e]}})})},e.classAnnations={name:"DoWhileActivity",params:{run:["data"]}},u.__decorate([m.Task(n.DoWhileActivityToken,n.DoWhileActivityBuilderToken)],e)}(m.Activity);n.DoWhileActivity=a;var e=function(o){function t(){return null!==o&&o.apply(this,arguments)||this}return u.__extends(t,o),t.prototype.buildStrategy=function(i,r){return u.__awaiter(this,void 0,void 0,function(){var e,n;return u.__generator(this,function(t){switch(t.label){case 0:return[4,o.prototype.buildStrategy.call(this,i,r)];case 1:return t.sent(),i instanceof a?(e=i,[4,this.build(r.do,i.id)]):[3,4];case 2:return e.body=t.sent(),n=i,[4,this.toExpression(r.while,i)];case 3:n.condition=t.sent(),t.label=4;case 4:return[2,i]}})})},t.classAnnations={name:"DoWhileActivityBuilder",params:{buildStrategy:["activity","config"]}},u.__decorate([l.Singleton(n.DoWhileActivityBuilderToken)],t)}(m.ActivityBuilder);n.DoWhileActivityBuilder=e});e(I);I.DoWhileActivityToken,I.DoWhileActivityBuilderToken,I.DoWhileActivity,I.DoWhileActivityBuilder;var j=n(function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.IfActivityToken=new m.InjectAcitityToken("if"),n.IfActivityBuilderToken=new m.InjectAcitityBuilderToken("if");var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u.__extends(e,t),e.prototype.run=function(e){return u.__awaiter(this,void 0,void 0,function(){return u.__generator(this,function(t){switch(t.label){case 0:return[4,this.context.exec(this,this.condition,e)];case 1:return t.sent()?[2,this.execIf(e)]:this.elseBody?[2,this.execElse(e)]:[2,Promise.resolve(e)]}})})},e.prototype.execIf=function(t){return this.ifBody.run(t)},e.prototype.execElse=function(t){return this.elseBody.run(t)},e.classAnnations={name:"IfActivity",params:{run:["data"],execIf:["data"],execElse:["data"]}},u.__decorate([m.Task(n.IfActivityToken,n.IfActivityBuilderToken)],e)}(m.Activity);n.IfActivity=s;var e=function(a){function t(){return null!==a&&a.apply(this,arguments)||this}return u.__extends(t,a),t.prototype.buildStrategy=function(r,o){return u.__awaiter(this,void 0,void 0,function(){var e,n,i;return u.__generator(this,function(t){switch(t.label){case 0:return[4,a.prototype.buildStrategy.call(this,r,o)];case 1:return t.sent(),r instanceof s?(e=r,[4,this.build(o.ifBody,r.id)]):[3,5];case 2:return e.ifBody=t.sent(),n=r,[4,this.toExpression(o.if,r)];case 3:return n.condition=t.sent(),o.elseBody?(i=r,[4,this.build(o.elseBody,r.id)]):[3,5];case 4:i.elseBody=t.sent(),t.label=5;case 5:return[2,r]}})})},t.classAnnations={name:"IfActivityBuilder",params:{buildStrategy:["activity","config"]}},u.__decorate([l.Singleton(n.IfActivityBuilderToken)],t)}(m.ActivityBuilder);n.IfActivityBuilder=e});e(j);j.IfActivityToken,j.IfActivityBuilderToken,j.IfActivity,j.IfActivityBuilder;var M=n(function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.InvokeActivityToken=new m.InjectAcitityToken("invoke");var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u.__extends(e,t),e.prototype.run=function(e){return u.__awaiter(this,void 0,void 0,function(){return u.__generator(this,function(t){return[2,this.context.getContainer().invoke(this.targetType,this.target,this.args,{data:e})]})})},e.classAnnations={name:"InvokeActivity",params:{run:["data"]}},u.__decorate([m.Task(n.InvokeActivityToken)],e)}(m.Activity);n.InvokeActivity=e});e(M);M.InvokeActivityToken,M.InvokeActivity;var P=n(function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ParallelActivityToken=new m.InjectAcitityToken("parallel"),n.ParallelActivityBuilderToken=new m.InjectAcitityBuilderToken("parallel");var o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.activites=[],t}return u.__extends(t,e),t.prototype.run=function(n,i){return u.__awaiter(this,void 0,void 0,function(){var e;return u.__generator(this,function(t){switch(t.label){case 0:return[4,this.before(n,i)];case 1:return e=t.sent(),[4,this.execute(e,i)];case 2:return e=t.sent(),[4,this.after(e,i)];case 3:return[2,e=t.sent()]}})})},t.prototype.before=function(e,t){return u.__awaiter(this,void 0,void 0,function(){return u.__generator(this,function(t){return[2,e]})})},t.prototype.execute=function(e,t){return Promise.all(this.activites.map(function(t){return t.run(e)}))},t.prototype.after=function(e,t){return u.__awaiter(this,void 0,void 0,function(){return u.__generator(this,function(t){return[2,e]})})},t.classAnnations={name:"ParallelActivity",params:{run:["data","execute"],before:["data","execute"],execute:["data","execute"],after:["data","execute"]}},u.__decorate([m.Task(n.ParallelActivityToken,n.ParallelActivityBuilderToken)],t)}(m.Activity);n.ParallelActivity=o;var e=function(i){function t(){return null!==i&&i.apply(this,arguments)||this}return u.__extends(t,i),t.prototype.buildStrategy=function(e,n){return u.__awaiter(this,void 0,void 0,function(){return u.__generator(this,function(t){switch(t.label){case 0:return[4,i.prototype.buildStrategy.call(this,e,n)];case 1:return t.sent(),e instanceof o&&n.parallel&&n.parallel.length?[4,this.buildChildren(e,n.parallel)]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2,e]}})})},t.prototype.buildChildren=function(r,n){return u.__awaiter(this,void 0,void 0,function(){var e,i=this;return u.__generator(this,function(t){switch(t.label){case 0:return[4,Promise.all(n.map(function(n){return u.__awaiter(i,void 0,void 0,function(){var e;return u.__generator(this,function(t){switch(t.label){case 0:return[4,this.build(n,r.id)];case 1:return(e=t.sent())?e instanceof o&&!l.isToken(n)&&n.parallel&&n.parallel.length?[4,this.buildChildren(e,n.parallel)]:[3,3]:[2,null];case 2:t.sent(),t.label=3;case 3:return[2,e]}})})}))];case 1:return e=t.sent(),r.activites=e,[2,r]}})})},t.classAnnations={name:"ParallelActivityBuilder",params:{buildStrategy:["activity","config"],buildChildren:["activity","configs"]}},u.__decorate([l.Singleton(n.ParallelActivityBuilderToken)],t)}(m.ActivityBuilder);n.ParallelActivityBuilder=e});e(P);P.ParallelActivityToken,P.ParallelActivityBuilderToken,P.ParallelActivity,P.ParallelActivityBuilder;var D=n(function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SequenceActivityToken=new m.InjectAcitityToken("sequence"),n.SequenceActivityBuilderToken=new m.InjectAcitityBuilderToken("sequence");var o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.activites=[],t}return u.__extends(t,e),t.prototype.run=function(n,i){return u.__awaiter(this,void 0,void 0,function(){var e;return u.__generator(this,function(t){switch(t.label){case 0:return[4,this.before(n,i)];case 1:return e=t.sent(),[4,this.execute(e,i)];case 2:return e=t.sent(),[4,this.after(e,i)];case 3:return[2,e=t.sent()]}})})},t.prototype.before=function(e,t){return u.__awaiter(this,void 0,void 0,function(){return u.__generator(this,function(t){return[2,e]})})},t.prototype.execute=function(t,e){var n=Promise.resolve(t);return this.activites.forEach(function(e){n=n.then(function(t){return e.run(t)})}),n},t.prototype.after=function(e,t){return u.__awaiter(this,void 0,void 0,function(){return u.__generator(this,function(t){return[2,e]})})},t.classAnnations={name:"SequenceActivity",params:{run:["data","execute"],before:["data","execute"],execute:["data","execute"],after:["data","execute"]}},u.__decorate([m.Task(n.SequenceActivityToken,n.SequenceActivityBuilderToken)],t)}(m.Activity);n.SequenceActivity=o;var e=function(i){function t(){return null!==i&&i.apply(this,arguments)||this}return u.__extends(t,i),t.prototype.buildStrategy=function(e,n){return u.__awaiter(this,void 0,void 0,function(){return u.__generator(this,function(t){switch(t.label){case 0:return[4,i.prototype.buildStrategy.call(this,e,n)];case 1:return t.sent(),e instanceof o&&n.sequence&&n.sequence.length?[4,this.buildChildren(e,n.sequence)]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2,e]}})})},t.prototype.buildChildren=function(r,n){return u.__awaiter(this,void 0,void 0,function(){var e,i=this;return u.__generator(this,function(t){switch(t.label){case 0:return[4,Promise.all(n.map(function(n){return u.__awaiter(i,void 0,void 0,function(){var e;return u.__generator(this,function(t){switch(t.label){case 0:return[4,this.build(n,r.id)];case 1:return(e=t.sent())?e instanceof o&&!l.isToken(n)&&n.sequence&&n.sequence.length?[4,this.buildChildren(e,n.sequence)]:[3,3]:[2,null];case 2:t.sent(),t.label=3;case 3:return[2,e]}})})}))];case 1:return e=t.sent(),r.activites=e,[2,r]}})})},t.classAnnations={name:"SequenceActivityBuilder",params:{buildStrategy:["activity","config"],buildChildren:["activity","configs"]}},u.__decorate([l.Singleton(n.SequenceActivityBuilderToken)],t)}(m.ActivityBuilder);n.SequenceActivityBuilder=e});e(D);D.SequenceActivityToken,D.SequenceActivityBuilderToken,D.SequenceActivity,D.SequenceActivityBuilder;var R=n(function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SwitchActivityToken=new m.InjectAcitityToken("switch"),n.SwitchActivityBuilderToken=new m.InjectAcitityBuilderToken("switch");var s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cases=new l.MapSet,t}return u.__extends(t,e),t.prototype.run=function(n){return u.__awaiter(this,void 0,void 0,function(){var e;return u.__generator(this,function(t){switch(t.label){case 0:return[4,this.context.exec(this,this.expression,n)];case 1:return e=t.sent(),!l.isUndefined(e)&&this.cases.has(e)?[2,this.cases.get(e).run(n)]:this.defaultBody?[2,this.defaultBody.run(n)]:[2,Promise.resolve(n)]}})})},t.classAnnations={name:"SwitchActivity",params:{run:["data"]}},u.__decorate([m.Task(n.SwitchActivityToken,n.SwitchActivityBuilderToken)],t)}(m.Activity);n.SwitchActivity=s;var e=function(a){function t(){return null!==a&&a.apply(this,arguments)||this}return u.__extends(t,a),t.prototype.buildStrategy=function(r,o){return u.__awaiter(this,void 0,void 0,function(){var e,n,i=this;return u.__generator(this,function(t){switch(t.label){case 0:return[4,a.prototype.buildStrategy.call(this,r,o)];case 1:return t.sent(),r instanceof s?(e=r,[4,this.toExpression(o.expression,r)]):[3,6];case 2:return e.expression=t.sent(),o.cases&&o.cases.length?[4,Promise.all(o.cases.map(function(n){return u.__awaiter(i,void 0,void 0,function(){var e;return u.__generator(this,function(t){switch(t.label){case 0:return[4,this.build(n.value,r.id)];case 1:return e=t.sent(),r.cases.set(n.key,e),[2,e]}})})}))]:[3,4];case 3:t.sent(),t.label=4;case 4:return o.defaultBody?(n=r,[4,this.build(o.defaultBody,r.id)]):[3,6];case 5:n.defaultBody=t.sent(),t.label=6;case 6:return[2,r]}})})},t.classAnnations={name:"SwitchActivityBuilder",params:{buildStrategy:["activity","config"]}},u.__decorate([l.Singleton(n.SwitchActivityBuilderToken)],t)}(m.ActivityBuilder);n.SwitchActivityBuilder=e});e(R);R.SwitchActivityToken,R.SwitchActivityBuilderToken,R.SwitchActivity,R.SwitchActivityBuilder;var O=n(function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ThrowActivityToken=new m.InjectAcitityToken("throw"),n.ThrowActivityBuilderToken=new m.InjectAcitityBuilderToken("delay");var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u.__extends(e,t),e.prototype.run=function(e){return u.__awaiter(this,void 0,void 0,function(){return u.__generator(this,function(t){switch(t.label){case 0:return[4,this.context.exec(this,this.exception,e)];case 1:throw t.sent()}})})},e.classAnnations={name:"ThrowActivity",params:{run:["data"]}},u.__decorate([m.Task(n.ThrowActivityToken,n.ThrowActivityBuilderToken)],e)}(m.Activity);n.ThrowActivity=o;var e=function(r){function t(){return null!==r&&r.apply(this,arguments)||this}return u.__extends(t,r),t.prototype.buildStrategy=function(n,i){return u.__awaiter(this,void 0,void 0,function(){var e;return u.__generator(this,function(t){switch(t.label){case 0:return[4,r.prototype.buildStrategy.call(this,n,i)];case 1:return t.sent(),n instanceof o?(e=n,[4,this.toExpression(i.exception,n)]):[3,3];case 2:e.exception=t.sent(),t.label=3;case 3:return[2,n]}})})},t.classAnnations={name:"ThrowActivityBuilder",params:{buildStrategy:["activity","config"]}},u.__decorate([l.Singleton(n.ThrowActivityBuilderToken)],t)}(m.ActivityBuilder);n.ThrowActivityBuilder=e});e(O);O.ThrowActivityToken,O.ThrowActivityBuilderToken,O.ThrowActivity,O.ThrowActivityBuilder;var U=n(function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.TryCatchActivityToken=new m.InjectAcitityToken("trycatch"),n.TryCatchActivityBuilderToken=new m.InjectAcitityBuilderToken("delay");var c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.catchs=[],t}return u.__extends(t,e),t.prototype.run=function(i){return u.__awaiter(this,void 0,void 0,function(){var n,e=this;return u.__generator(this,function(t){try{n=this.try.run(i),this.catchs.forEach(function(e){n=n.catch(function(t){return e.run(t)})}),this.finally&&n.then(function(t){return e.finally.run(t)})}catch(t){n=Promise.resolve(i),this.finally&&n.then(function(t){return e.finally.run(t)})}return[2,n]})})},t.classAnnations={name:"TryCatchActivity",params:{run:["data"]}},u.__decorate([m.Task(n.TryCatchActivityToken,n.TryCatchActivityBuilderToken)],t)}(y.Activity);n.TryCatchActivity=c;var e=function(s){function t(){return null!==s&&s.apply(this,arguments)||this}return u.__extends(t,s),t.prototype.buildStrategy=function(o,a){return u.__awaiter(this,void 0,void 0,function(){var e,n,i,r=this;return u.__generator(this,function(t){switch(t.label){case 0:return[4,s.prototype.buildStrategy.call(this,o,a)];case 1:return t.sent(),o instanceof c?(e=o,[4,this.build(a.try,o.id)]):[3,6];case 2:return e.try=t.sent(),a.catchs&&a.catchs.length?[4,Promise.all(a.catchs.map(function(t){return r.build(t,o.id)}))]:[3,4];case 3:n=t.sent(),o.catchs=n,t.label=4;case 4:return a.finally?(i=o,[4,this.build(a.finally,o.id)]):[3,6];case 5:i.finally=t.sent(),t.label=6;case 6:return[2,o]}})})},t.classAnnations={name:"TryCatchActivityBuilder",params:{buildStrategy:["activity","config"]}},u.__decorate([l.Singleton(n.TryCatchActivityBuilderToken)],t)}(m.ActivityBuilder);n.TryCatchActivityBuilder=e});e(U);U.TryCatchActivityToken,U.TryCatchActivityBuilderToken,U.TryCatchActivity,U.TryCatchActivityBuilder;var E=n(function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.WhileActivityToken=new m.InjectAcitityToken("while"),n.WhileActivityBuilderToken=new m.InjectAcitityBuilderToken("while");var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u.__extends(e,t),e.prototype.run=function(i){return u.__awaiter(this,void 0,void 0,function(){var e,n;return u.__generator(this,function(t){switch(t.label){case 0:return[4,this.context.exec(this,this.condition,i)];case 1:e=t.sent(),t.label=2;case 2:return e?[4,this.body.run(n||i)]:[3,5];case 3:return n=t.sent(),[4,this.context.exec(this,this.condition,n)];case 4:return e=t.sent(),[3,2];case 5:return[2,n]}})})},e.classAnnations={name:"WhileActivity",params:{run:["data"]}},u.__decorate([m.Task(n.WhileActivityToken,n.WhileActivityBuilderToken)],e)}(m.Activity);n.WhileActivity=a;var e=function(o){function t(){return null!==o&&o.apply(this,arguments)||this}return u.__extends(t,o),t.prototype.buildStrategy=function(i,r){return u.__awaiter(this,void 0,void 0,function(){var e,n;return u.__generator(this,function(t){switch(t.label){case 0:return[4,o.prototype.buildStrategy.call(this,i,r)];case 1:return t.sent(),i instanceof a?(e=i,[4,this.build(r.body,i.id)]):[3,4];case 2:return e.body=t.sent(),n=i,[4,this.toExpression(r.while,i)];case 3:n.condition=t.sent(),t.label=4;case 4:return[2,i]}})})},t.classAnnations={name:"WhileActivityBuilder",params:{buildStrategy:["activity","config"]}},u.__decorate([l.Singleton(n.WhileActivityBuilderToken)],t)}(m.ActivityBuilder);n.WhileActivityBuilder=e});e(E);E.WhileActivityToken,E.WhileActivityBuilderToken,E.WhileActivity,E.WhileActivityBuilder;var q=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),u.__exportStar(S,e),u.__exportStar(C,e),u.__exportStar(I,e),u.__exportStar(j,e),u.__exportStar(M,e),u.__exportStar(P,e),u.__exportStar(D,e),u.__exportStar(R,e),u.__exportStar(O,e),u.__exportStar(U,e),u.__exportStar(E,e)});e(q);var W=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(i){function t(t){var e=i.call(this,t)||this;return e.rootPath=t,e.logAspects=[],e}return u.__extends(t,i),t.prototype.useLog=function(t){return l.hasClassMetadata(o.Aspect,t)?this.logAspects.push(t):console.error("logAspect param is not right aspect"),this},t.prototype.createWorkflow=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return u.__awaiter(this,void 0,void 0,function(){return u.__generator(this,function(t){switch(t.label){case 0:return[4,this.build.apply(this,e)];case 1:return[2,t.sent()]}})})},t.prototype.bootstrap=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return u.__awaiter(this,void 0,void 0,function(){var e;return u.__generator(this,function(t){switch(t.label){case 0:return[4,this.build.apply(this,n)];case 1:return[4,(e=t.sent()).start()];case 2:return t.sent(),[2,e]}})})},t.prototype.getRootPath=function(){return this.rootPath},t.prototype.build=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return u.__awaiter(this,void 0,void 0,function(){var e;return u.__generator(this,function(t){switch(t.label){case 0:return e=1<n.length?{sequence:n,task:q.SequenceActivity}:l.lang.first(n),[4,i.prototype.build.call(this,e)];case 1:return[2,t.sent()]}})})},t.prototype.createInstance=function(e,n){return u.__awaiter(this,void 0,void 0,function(){return u.__generator(this,function(t){return[2,this.getContainer().resolve(m.TaskRunnerToken,{activity:n,activityBuilder:e})]})})},t.prototype.createModuleBuilder=function(){return this.getContainer().get(m.ActivityBuilderToken)},t.prototype.registerExts=function(e){return u.__awaiter(this,void 0,void 0,function(){return u.__generator(this,function(t){switch(t.label){case 0:return e.has(o.AopModule)||e.register(o.AopModule),e.has(a.LogModule)||e.register(a.LogModule),e.bindProvider(s.TaskContainerToken,this),e.has(x.CoreModule)||e.register(x.CoreModule),this.use(q),this.beforRegister(e),[4,i.prototype.registerExts.call(this,e)];case 1:return t.sent(),[2,e]}})})},t.prototype.beforRegister=function(e){this.logAspects.forEach(function(t){t&&e.register(t)})},t.classAnnations={name:"DefaultTaskContainer",params:{constructor:["rootPath"],useLog:["logAspect"],createWorkflow:["tasks"],bootstrap:["tasks"],getRootPath:[],build:["tasks"],createInstance:["builder","config"],createModuleBuilder:[],registerExts:["container"],beforRegister:["container"]}},t}(_.ApplicationBuilder);e.DefaultTaskContainer=n});e(W);W.DefaultTaskContainer;var F=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.pick=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var i={};return t.forEach(function(t){i[t]=e[t]}),i}});e(F);F.pick;var L=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),u.__exportStar(F,e)});return e(L),e(n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),u.__exportStar(s,e),u.__exportStar(W,e),u.__exportStar(L,e),u.__exportStar(m,e),u.__exportStar(w,e),u.__exportStar(q,e)}))});