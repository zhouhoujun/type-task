!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("tslib"),require("@ts-ioc/core"),require("reflect-metadata"),require("events"),require("rxjs/BehaviorSubject"),require("rxjs/add/operator/filter"),require("@ts-ioc/aop"),require("@ts-ioc/logs")):"function"==typeof define&&define.amd?define(["tslib","@ts-ioc/core","reflect-metadata","events","rxjs/BehaviorSubject","rxjs/add/operator/filter","@ts-ioc/aop","@ts-ioc/logs"],e):(t.core=t.core||{},t.core.umd=t.core.umd||{},t.core.umd.js=e(t.tslib_1,t.core_1,t.Reflect,t.events,t.BehaviorSubject_1,t.filter,t.aop_1,t.logs))}(this,function(u,l,n,r,o,t,i,a){"use strict";u=u&&u.hasOwnProperty("default")?u.default:u,l=l&&l.hasOwnProperty("default")?l.default:l,n=n&&n.hasOwnProperty("default")?n.default:n,r=r&&r.hasOwnProperty("default")?r.default:r,o=o&&o.hasOwnProperty("default")?o.default:o,t=t&&t.hasOwnProperty("default")?t.default:t,i=i&&i.hasOwnProperty("default")?i.default:i,a=a&&a.hasOwnProperty("default")?a.default:a;"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function s(t,e){return t(e={exports:{}},e.exports),e.exports}var c=s(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.TaskContainerToken=new l.InjectToken("__TASK_TaskContainer")});e(c);c.TaskContainerToken;var d=s(function(t,e){t.exports=function(f,p,t,i){function e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function n(t,e){return t(e={exports:{}},e.exports),e.exports}f=f&&f.hasOwnProperty("default")?f.default:f,p=p&&p.hasOwnProperty("default")?p.default:p,t=t&&t.hasOwnProperty("default")?t.default:t,i=i&&i.hasOwnProperty("default")?i.default:i;var r=n(function(t,e){function n(t,e,n,r){return p.createClassDecorator(t,function(t){n&&n(t)},function(t){return r&&(t=r(t)),e&&!t.annotationBuilder&&(t.annotationBuilder=e),t})}Object.defineProperty(e,"__esModule",{value:!0}),e.createAnnotationDecorator=n,e.Annotation=n("Annotation")});e(r),r.createAnnotationDecorator,r.Annotation;var a=n(function(t,e){function n(n,r,o,e,i){return p.createClassDecorator(n,function(t){e&&e(t)},function(t){if(i&&(t=i(t)),!t.name&&p.isClass(t.token)){var e=/^[a-z]$/.test(t.token.name);e&&t.token.classAnnations?t.name=t.token.classAnnations.name:t.name=t.token.name}return t.decorType=n,r&&!t.builder&&(t.builder=r),o&&!t.annotationBuilder&&(t.annotationBuilder=o),t})}Object.defineProperty(e,"__esModule",{value:!0}),e.createDIModuleDecorator=n,e.DIModule=n("DIModule")});e(a),a.createDIModuleDecorator,a.DIModule;var o=n(function(t,e){function n(t,e,n,r,o){return a.createDIModuleDecorator(t,e,n,r,function(n){return o&&o(n),n.builder&&setTimeout(function(){var t,e=n.builder;p.isClass(e)?t=p.isFunction(e.create)?e.create():new e:p.isObject(e)&&(t=e),t&&(n.globals&&t.use.apply(t,n.globals),t.bootstrap(n.type))},500),n})}Object.defineProperty(e,"__esModule",{value:!0}),e.createBootstrapDecorator=n,e.Bootstrap=n("Bootstrap")});e(o),o.createBootstrapDecorator,o.Bootstrap;var s=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),f.__exportStar(r,e),f.__exportStar(a,e),f.__exportStar(o,e)});e(s);var c=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.AppConfigureToken=new p.InjectToken("DI_APP_Configuration"),e.DefaultConfigureToken=new p.InjectToken("DI_Default_Configuration"),e.AppConfigureLoaderToken=new p.InjectToken("DI_Configure_Loader")});e(c),c.AppConfigureToken,c.DefaultConfigureToken,c.AppConfigureLoaderToken;var u=n(function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.DIModuelValidateToken=new p.InjectModuleValidateToken(s.DIModule.toString());var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return f.__extends(e,t),e.prototype.getDecorator=function(){return s.DIModule.toString()},e.classAnnations={name:"DIModuelValidate",params:{getDecorator:[]}},e=f.__decorate([p.Singleton(n.DIModuelValidateToken)],e)}(p.BaseModuelValidate);n.DIModuelValidate=e});e(u),u.DIModuelValidateToken,u.DIModuelValidate;var l=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){this.pools=new p.MapSet}return t.prototype.getTokenKey=function(t){return t instanceof p.Registration?t.toString():t},t.prototype.isDefault=function(t){return t===this.defaults},t.prototype.hasDefault=function(){return!!this.defaults},t.prototype.setDefault=function(t){this.defaults=t},t.prototype.getDefault=function(){return this.defaults},t.prototype.set=function(t,e){this.getTokenKey(t),this.pools.has(t)&&console.log(t.toString()+" module has loaded"),this.pools.set(t,e)},t.prototype.get=function(t){var e=this.getTokenKey(t);return this.has(e)?this.pools.get(t):null},t.prototype.has=function(t){return this.pools.has(this.getTokenKey(t))},t.prototype.create=function(t){var e=(t=t||this.getDefault()).getBuilder().create();return this.setParent(e,t),e},t.prototype.setParent=function(t,e){this.isDefault(t)||(t.parent=e&&e!==t?e:this.getDefault())},t.classAnnations={name:"ContainerPool",params:{constructor:[],getTokenKey:["token"],isDefault:["container"],hasDefault:[],setDefault:["container"],getDefault:[],set:["token","container"],get:["token"],has:["token"],create:["parent"],setParent:["container","parent"]}},t}();e.ContainerPool=n,e.ContainerPoolToken=new p.InjectToken("ContainerPool")});e(l),l.ContainerPool,l.ContainerPoolToken;var d=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),f.__exportStar(l,e)});e(d);var v=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n="DI_AnnotationBuilder",r=function(e){function t(t){return e.call(this,t,n)||this}return f.__extends(t,e),t.classAnnations={name:"InjectAnnotationBuilder",params:{constructor:["type"]}},t}(p.Registration);e.InjectAnnotationBuilder=r,e.AnnotationBuilderToken=new p.Registration(Object,n),e.DefaultAnnotationBuilderToken=new r("default")});e(v),v.InjectAnnotationBuilder,v.AnnotationBuilderToken,v.DefaultAnnotationBuilderToken;var h=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){}var o;return(o=t).prototype.build=function(r,o,i){return f.__awaiter(this,void 0,void 0,function(){var e,n;return f.__generator(this,function(t){switch(t.label){case 0:return p.isClass(r)&&!this.container.hasRegister(r)&&this.container.register(r),o=this.getTokenMetaConfig(r,o),e=this.getBuilder(r,o),this.isEqual(e)?[3,1]:[2,e.build(r,o,i)];case 1:return[4,this.createInstance(r,o,i)];case 2:return(n=t.sent())?p.isFunction(n.anBeforeInit)?[4,Promise.resolve(n.anBeforeInit(o))]:[3,4]:[2,null];case 3:t.sent(),t.label=4;case 4:return[4,this.buildStrategy(n,o)];case 5:return n=t.sent(),p.isFunction(n.anAfterInit)?[4,Promise.resolve(n.anAfterInit(o))]:[3,7];case 6:t.sent(),t.label=7;case 7:return[2,n]}})})},t.prototype.buildByConfig=function(n,r){return f.__awaiter(this,void 0,void 0,function(){var e;return f.__generator(this,function(t){return p.isToken(n)?(e=n,[2,this.build(e,null,r)]):(e=this.getType(n),[2,this.build(e,n,r)])})})},t.prototype.createInstance=function(e,t,n){return f.__awaiter(this,void 0,void 0,function(){return f.__generator(this,function(t){return e?this.container.has(e)?[2,this.resolveToken(e,n)]:(console.log("can not find token "+(e?e.toString():null)+" in container."),[2,null]):(console.log("can not find annotation token."),[2,null])})})},t.prototype.getBuilder=function(t,e){var n,r=this;return e&&e.annotationBuilder&&(p.isClass(e.annotationBuilder)&&(this.container.has(e.annotationBuilder)||this.container.register(e.annotationBuilder)),p.isToken(e.annotationBuilder)?n=this.container.resolve(e.annotationBuilder,{container:this.container}):e.annotationBuilder instanceof o&&(n=e.annotationBuilder)),!n&&t&&this.container.getTokenExtendsChain(t).forEach(function(t){if(n)return!1;var e=new v.InjectAnnotationBuilder(t);return r.container.has(e)&&(n=r.container.resolve(e,{container:r.container})),!0}),n&&!n.container&&(n.container=this.container),n||this},t.prototype.buildStrategy=function(e,t){return f.__awaiter(this,void 0,void 0,function(){return f.__generator(this,function(t){return[2,e]})})},t.prototype.getType=function(t){return t.token||t.type},t.prototype.getTokenMetaConfig=function(t,e){var n;if(p.isClass(t))n=this.getMetaConfig(t);else if(p.isToken(t)){var r=this.container?this.container.getTokenImpl(t):t;p.isClass(r)&&(n=this.getMetaConfig(r))}return n?p.lang.assign({},n,e||{}):e||{}},t.prototype.getDecorator=function(){return s.Annotation.toString()},t.prototype.getMetaConfig=function(t){var e=this.getDecorator();if(p.hasOwnClassMetadata(e,t)){var n=p.getTypeMetadata(e,t);if(n&&n.length)return n[0]}return null},t.prototype.isEqual=function(t){return!!t&&(t===this||t.constructor===this.constructor)},t.prototype.resolveToken=function(t,e){return this.container.resolve(t,e)},t.classAnnations={name:"AnnotationBuilder",params:{constructor:[],build:["token","config","data"],buildByConfig:["config","data"],createInstance:["token","config","data"],getBuilder:["token","config"],buildStrategy:["instance","config"],getType:["config"],getTokenMetaConfig:["token","config"],getDecorator:[],getMetaConfig:["token"],isEqual:["build"],resolveToken:["token","data"]}},f.__decorate([p.Inject(p.ContainerToken),f.__metadata("design:type",Object)],t.prototype,"container",void 0),t=o=f.__decorate([p.Injectable(v.AnnotationBuilderToken),f.__metadata("design:paramtypes",[])],t)}();e.AnnotationBuilder=n});e(h),h.AnnotationBuilder;var _=n(function(t,r){Object.defineProperty(r,"__esModule",{value:!0});var i=function(e){function t(t){return e.call(this,t,"boot__metaAccessor")||this}return f.__extends(t,e),t.classAnnations={name:"InjectMetaAccessorToken",params:{constructor:["type"]}},t}(p.Registration);r.InjectMetaAccessorToken=i,r.DefaultMetaAccessorToken=new i("default");var e=function(){function t(t){this.decorator=t}return t.prototype.getDecorator=function(){return this.decorator},t.prototype.getMetadata=function(t,e){var n=p.isClass(t)?t:e.getTokenImpl(t);if(p.isClass(n)){var r=p.getTypeMetadata(this.getDecorator(),n);if(r&&r.length){var o=r[0];return o}}return{}},t.classAnnations={name:"MetaAccessor",params:{constructor:["decorator"],getDecorator:[],getMetadata:["token","container"]}},t=f.__decorate([p.Injectable(r.DefaultMetaAccessorToken),f.__metadata("design:paramtypes",[String])],t)}();r.MetaAccessor=e,r.AnnotationMetaAccessorToken=new i("Annotation");var n=function(){function t(t){this.decorator=t}return t.prototype.getDecorator=function(){return this.decorator},t.prototype.getMetadata=function(t,n){if(p.isToken(t)){var r,o={decorator:this.getDecorator()};return n.getTokenExtendsChain(t).forEach(function(t){if(r)return!1;var e=new i(t);return n.has(e)&&(r=n.resolve(e,o)),!0}),r||(r=this.getDefaultMetaAccessor(n,o)),r?r.getMetadata(t,n):{}}return{}},t.prototype.getDefaultMetaAccessor=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return t.resolve.apply(t,[r.DefaultMetaAccessorToken].concat(e))},t.classAnnations={name:"AnnotationMetaAccessor",params:{constructor:["decorator"],getDecorator:[],getMetadata:["token","container"],getDefaultMetaAccessor:["container","providers"]}},t=f.__decorate([p.Injectable(r.AnnotationMetaAccessorToken),f.__metadata("design:paramtypes",[String])],t)}();r.AnnotationMetaAccessor=n});e(_),_.InjectMetaAccessorToken,_.DefaultMetaAccessorToken,_.MetaAccessor,_.AnnotationMetaAccessorToken,_.AnnotationMetaAccessor;var y=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),f.__exportStar(h,e),f.__exportStar(v,e),f.__exportStar(_,e)});e(y);var g=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,n){this.token=t,this.config=e,this.container=n}return t.classAnnations={name:"InjectedModule",params:{constructor:["token","config","container"]}},t}();e.InjectedModule=n;var r=function(e){function t(t){return e.call(this,t,"InjectedModule")||this}return f.__extends(t,e),t.classAnnations={name:"InjectedModuleToken",params:{constructor:["type"]}},t}(p.Registration);e.InjectedModuleToken=r});e(g),g.InjectedModule,g.InjectedModuleToken;var A=n(function(t,n){Object.defineProperty(n,"__esModule",{value:!0});var a="__exportProviders";n.DIModuleInjectorToken=new p.InjectModuleInjectorToken(s.DIModule.toString());var e=function(e){function t(t){return e.call(this,t)||this}return f.__extends(t,e),t.prototype.setup=function(e,n){return f.__awaiter(this,void 0,void 0,function(){return f.__generator(this,function(t){switch(t.label){case 0:return[4,this.importModule(e,n)];case 1:return t.sent(),[2]}})})},t.prototype.import=function(e,n){return f.__awaiter(this,void 0,void 0,function(){return f.__generator(this,function(t){switch(t.label){case 0:return this.validate.validate(n)?[4,this.importModule(e,n)]:[3,2];case 1:return[2,t.sent()];case 2:return[2,null]}})})},t.prototype.importByConfig=function(e,n){return f.__awaiter(this,void 0,void 0,function(){return f.__generator(this,function(t){switch(t.label){case 0:return[4,this.registerConfgureDepds(e,n)];case 1:return t.sent(),p.isArray(n.providers)&&n.providers.length?[4,this.bindProvider(e,n.providers)]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2,null]}})})},t.prototype.importModule=function(i,a){return f.__awaiter(this,void 0,void 0,function(){var e,n,r,o;return f.__generator(this,function(t){switch(t.label){case 0:return e=i.get(d.ContainerPoolToken),(n=e.create(i)).register(a),r=this.getMetaConfig(a,n),[4,this.registerConfgureDepds(n,r)];case 1:return t.sent(),[4,this.importConfigExports(i,n,r,a)];case 2:return t.sent(),o=new g.InjectedModule(a,r,n),i.bindProvider(new g.InjectedModuleToken(a),o),[2,o]}})})},t.prototype.getMetaConfig=function(t,e){if(p.isToken(t)){var n=this.getMetaAccessor(e);return n.getMetadata(t,e)}return null},t.prototype.getMetaAccessor=function(t){var e=this.validate.getDecorator();return t.resolve(y.AnnotationMetaAccessorToken,{decorator:e})},t.prototype.registerConfgureDepds=function(e,n){return f.__awaiter(this,void 0,void 0,function(){return f.__generator(this,function(t){switch(t.label){case 0:return p.isArray(n.imports)&&n.imports.length?[4,e.loadModule.apply(e,n.imports)]:[3,2];case 1:t.sent(),t.label=2;case 2:return p.isArray(n.providers)&&n.providers.length&&(n[a]=this.bindProvider(e,n.providers)),[2,n]}})})},t.prototype.importConfigExports=function(r,o,n,i){return f.__awaiter(this,void 0,void 0,function(){var e;return f.__generator(this,function(t){return r===o||(n.exports&&n.exports.length&&n.exports.forEach(function(n){r.bindProvider(n,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return o.resolve.apply(o,[n].concat(t))})}),i&&r.bindProvider(i,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return o.resolve.apply(o,[i].concat(t))}),(e=n[a])&&e.length&&e.forEach(function(t){r.bindProvider(t,function(){return o.get(t)})})),[2,r]})})},t.prototype.bindProvider=function(o,t){var i=[];return t.forEach(function(n,t){if(!p.isUndefined(n)&&!p.isNull(n))if(p.isProviderMap(n))n.forEach(function(t,e){i.push(t),o.bindProvider(t,e)});else if(n instanceof p.Provider)i.push(n.type),o.bindProvider(n.type,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return n.resolve.apply(n,[o].concat(t))});else if(p.isClass(n))o.has(n)||(i.push(n),o.register(n));else if(p.isBaseObject(n)){var e=n,r=!1;p.isToken(e.provide)?(p.isArray(e.deps)&&e.deps.length&&e.deps.forEach(function(t){p.isClass(t)&&!o.has(t)&&o.register(t)}),p.isUndefined(e.useValue)?p.isClass(e.useClass)?(o.has(e.useClass)||o.register(e.useClass),i.push(e.provide),o.bindProvider(e.provide,e.useClass)):p.isFunction(e.useFactory)?(i.push(e.provide),o.bindProvider(e.provide,function(){var t=[];return p.isArray(e.deps)&&e.deps.length&&(t=e.deps.map(function(t){return p.isClass(t)?o.get(t):t})),e.useFactory.apply(e,t)})):p.isToken(e.useExisting)?o.has(e.useExisting)?(i.push(e.provide),o.bindProvider(e.provide,e.useExisting)):console.log("has not register:",e.useExisting):r=!0:(i.push(e.provide),o.bindProvider(e.provide,function(){return e.useValue}))):r=!0,r&&p.lang.forIn(n,function(t,e){p.isUndefined(t)||(p.isClass(t)?o.bindProvider(e,t):p.isFunction(t)||p.isString(t)?o.bindProvider(e,function(){return t}):o.bindProvider(e,t),i.push(e))})}else p.isFunction(n)&&(i.push(name),o.bindProvider(name,function(){return n}))}),i},t.classAnnations={name:"DIModuleInjector",params:{constructor:["validate"],setup:["container","type"],import:["container","type"],importByConfig:["container","config"],importModule:["container","type"],getMetaConfig:["token","container"],getMetaAccessor:["container"],registerConfgureDepds:["container","config"],importConfigExports:["container","providerContainer","cfg","mdl"],bindProvider:["container","providers"]}},t=f.__decorate([p.Injectable(n.DIModuleInjectorToken),f.__param(0,p.Inject(u.DIModuelValidateToken)),f.__metadata("design:paramtypes",[Object])],t)}(p.ModuleInjector);n.DIModuleInjector=e});e(A),A.DIModuleInjectorToken,A.DIModuleInjector;var k=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n="DI_ModuleBuilder",r=function(e){function t(t){return e.call(this,t,n)||this}return f.__extends(t,e),t.classAnnations={name:"InjectModuleBuilderToken",params:{constructor:["type"]}},t}(p.Registration);e.InjectModuleBuilderToken=r,e.DefaultModuleBuilderToken=new r(Object),e.ModuleBuilderToken=new p.Registration(Object,n)});e(k),k.InjectModuleBuilderToken,k.DefaultModuleBuilderToken,k.ModuleBuilderToken;var b=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){}return t.classAnnations={name:"Boot",params:{run:["app"]}},t}();e.Boot=n;var r=function(e){function t(t){return e.call(this,t,"boot__runner")||this}return f.__extends(t,e),t.classAnnations={name:"InjectRunnerToken",params:{constructor:["type"]}},t}(p.Registration);e.InjectRunnerToken=r,e.DefaultRunnerToken=new r("default")});e(b),b.Boot,b.InjectRunnerToken,b.DefaultRunnerToken;var T=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){}return t.classAnnations={name:"Service",params:{start:[],stop:[]}},t}();e.Service=n;var r=function(e){function t(t){return e.call(this,t,"boot__service")||this}return f.__extends(t,e),t.classAnnations={name:"InjectServiceToken",params:{constructor:["type"]}},t}(p.Registration);e.InjectServiceToken=r,e.DefaultServiceToken=new r("default")});e(T),T.Service,T.InjectServiceToken,T.DefaultServiceToken;var m=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),f.__exportStar(b,e),f.__exportStar(T,e)});e(m);var w=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(t){return e.call(this,t,"module_loader")||this}return f.__extends(t,e),t.classAnnations={name:"InjectModuleLoadToken",params:{constructor:["token"]}},t}(p.Registration);e.InjectModuleLoadToken=n;var r=function(){function t(){}return t.prototype.getPools=function(){return this.pools},t.prototype.build=function(s,c,u){return f.__awaiter(this,void 0,void 0,function(){var e,n,r,o,i,a;return f.__generator(this,function(t){switch(t.label){case 0:return[4,this.load(s,c)];case 1:return e=t.sent(),n=e.container,r=e.config,o=this.getAnnoBuilder(n,e.token,r.annotationBuilder),e.token?[3,3]:[4,o.buildByConfig(r,u)];case 2:return[2,i=t.sent()];case 3:return[4,o.build(e.token,r,u)];case 4:return i=t.sent(),(a=i)&&p.isFunction(a.mdOnInit)&&a.mdOnInit(e),[2,i]}})})},t.prototype.bootstrap=function(u,l,d){return f.__awaiter(this,void 0,void 0,function(){var e,n,r,o,i,a,s,c;return f.__generator(this,function(t){switch(t.label){case 0:return[4,this.load(u,l)];case 1:return e=t.sent(),n=e.config,r=e.container,[4,this.build(u,e,d)];case 2:return o=t.sent(),i=this.getBootType(n),a=this.getAnnoBuilder(r,i,n.annotationBuilder),[4,i?a.build(i,n,d):a.buildByConfig(n,d)];case 3:return(s=t.sent())?[4,this.autoRun(r,i||a.getType(n),n,s)]:[3,7];case 4:return c=t.sent(),o&&p.isFunction(o.mdOnStart)?[4,Promise.resolve(o.mdOnStart(s))]:[3,6];case 5:t.sent(),t.label=6;case 6:return[3,9];case 7:return[4,this.autoRun(r,e.token,n,o)];case 8:c=t.sent(),t.label=9;case 9:return[2,c]}})})},t.prototype.import=function(r,o){return f.__awaiter(this,void 0,void 0,function(){var e,n;return f.__generator(this,function(t){switch(t.label){case 0:return o?[3,2]:[4,this.getParentContainer()];case 1:o=t.sent(),t.label=2;case 2:return e=p.isClass(r)?r:o.getTokenImpl(r),p.isClass(e)?(n=new g.InjectedModuleToken(e),o.hasRegister(n.toString())?[2,o.get(n)]:[3,3]):[3,5];case 3:return[4,o.loadModule(e)];case 4:if(t.sent(),o.has(n))return[2,o.get(n)];t.label=5;case 5:return[2,null]}})})},t.prototype.load=function(a,s){return f.__awaiter(this,void 0,void 0,function(){var e,n,r,o,i;return f.__generator(this,function(t){switch(t.label){case 0:return s instanceof g.InjectedModule?[2,s]:(e=null,[4,this.getParentContainer(s)]);case 1:return n=t.sent(),p.isToken(a)?[4,this.import(a,n)]:[3,3];case 2:return(e=t.sent())||(r=n.get(y.AnnotationMetaAccessorToken).getMetadata(a,n),e=new g.InjectedModule(a,r,n)),[3,10];case 3:return o=this.getType(a),p.isToken(o)?[4,this.import(o,n)]:[3,7];case 4:return(e=t.sent())instanceof g.InjectedModule?[4,(i=e.container).get(A.DIModuleInjectorToken).importByConfig(i,a)]:[3,6];case 5:t.sent(),e.config=p.lang.assign(e.config,a),t.label=6;case 6:return[3,8];case 7:o=null,t.label=8;case 8:return e?[3,10]:[4,n.get(A.DIModuleInjectorToken).importByConfig(n,a)];case 9:t.sent(),e=new g.InjectedModule(o,a,n),t.label=10;case 10:return[2,e]}})})},t.prototype.getParentContainer=function(n){return f.__awaiter(this,void 0,void 0,function(){var e;return f.__generator(this,function(t){return n&&(n instanceof p.Container?e=n:n instanceof g.InjectedModule&&(e=n.container.parent)),e||(e=this.getPools().getDefault()),[2,e]})})},t.prototype.autoRun=function(a,e,n,s){return f.__awaiter(this,void 0,void 0,function(){var r,o,i;return f.__generator(this,function(t){switch(t.label){case 0:return s?s instanceof m.Boot?[4,s.run()]:[3,2]:[2,null];case 1:return t.sent(),[2,s];case 2:return s instanceof m.Service?[4,s.start()]:[3,4];case 3:return t.sent(),[2,s];case 4:return i={token:e,instance:s,config:n},a.getTokenExtendsChain(e).forEach(function(t){if(r||o)return!1;var e=new m.InjectRunnerToken(t);a.has(e)&&(r=a.resolve(e,i));var n=new m.InjectServiceToken(t);return a.has(n)&&(o=a.resolve(n,i)),!0}),r||this.getDefaultRunner(a,i),r||o||this.getDefaultService(a,i),r?[4,r.run(s)]:[3,6];case 5:return t.sent(),[2,r];case 6:return o?[4,o.start()]:[3,8];case 7:return t.sent(),[2,o];case 8:return e&&n.autorun?[4,a.invoke(e,n.autorun,s)]:[3,10];case 9:return t.sent(),[2,s];case 10:return[2,s]}})})},t.prototype.getDefaultRunner=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return t.has(m.DefaultRunnerToken)?t.resolve.apply(t,[m.DefaultRunnerToken].concat(e)):null},t.prototype.getDefaultService=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return t.has(m.DefaultServiceToken)?t.resolve.apply(t,[m.DefaultServiceToken].concat(e)):null},t.prototype.getAnnoBuilder=function(n,t,e){var r;return p.isClass(e)&&(n.has(e)||n.register(e)),p.isToken(e)?r=n.resolve(e):e instanceof y.AnnotationBuilder&&(r=e),!r&&t&&n.getTokenExtendsChain(t).forEach(function(t){if(r)return!1;var e=new y.InjectAnnotationBuilder(t);return n.has(e)&&(r=n.resolve(e)),!0}),r||(r=this.getDefaultAnnBuilder(n)),r&&(r.container=n),r},t.prototype.getDefaultAnnBuilder=function(t){return t.has(y.DefaultAnnotationBuilderToken)?t.resolve(y.DefaultAnnotationBuilderToken):t.resolve(y.AnnotationBuilderToken)},t.prototype.getType=function(t){return t.token||t.type},t.prototype.getBootType=function(t){return t.bootstrap},t.classAnnations={name:"ModuleBuilder",params:{constructor:[],getPools:[],build:["token","env","data"],bootstrap:["token","env","data"],import:["token","parent"],load:["token","env"],getParentContainer:["env"],autoRun:["container","token","cfg","instance"],getDefaultRunner:["container","providers"],getDefaultService:["container","providers"],getAnnoBuilder:["container","token","annBuilder"],getDefaultAnnBuilder:["container"],getType:["cfg"],getBootType:["cfg"]}},f.__decorate([p.Inject(d.ContainerPoolToken),f.__metadata("design:type",d.ContainerPool)],t.prototype,"pools",void 0),t=f.__decorate([p.Singleton(k.ModuleBuilderToken),f.__metadata("design:paramtypes",[])],t)}();e.ModuleBuilder=r});e(w),w.InjectModuleLoadToken,w.ModuleBuilder;var I=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),f.__exportStar(A,e),f.__exportStar(u,e),f.__exportStar(g,e),f.__exportStar(k,e),f.__exportStar(w,e)});e(I);var M=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.container=t}return t.prototype.setup=function(){var t=this.container,e=t.get(p.LifeScopeToken);e.registerDecorator(s.DIModule,p.CoreActions.bindProvider,p.CoreActions.cache,p.CoreActions.componentBeforeInit,p.CoreActions.componentInit,p.CoreActions.componentAfterInit),e.registerDecorator(s.Bootstrap,p.CoreActions.bindProvider,p.CoreActions.cache,p.CoreActions.componentBeforeInit,p.CoreActions.componentInit,p.CoreActions.componentAfterInit),t.use(y,I,C)},t.classAnnations={name:"BootModule",params:{constructor:["container"],setup:[]}},t=f.__decorate([p.IocExt("setup"),f.__param(0,p.Inject(p.ContainerToken)),f.__metadata("design:paramtypes",[Object])],t)}();e.BootModule=n});e(M),M.BootModule;var j=n(function(t,e){var o,n;Object.defineProperty(e,"__esModule",{value:!0}),(n=o=e.ApplicationEvents||(e.ApplicationEvents={})).onRootContainerCreated="onRootContainerCreated",n.onRootContainerInited="onRooConatianerInited";var r=function(a){function e(t){var e=a.call(this)||this;return e.baseURL=t,e.inited=!1,e.customRegs=[],e.globalModules=[],e.configs=[],e.providers=new p.MapSet,e.events=new i.EventEmitter,e}return f.__extends(e,a),e.create=function(t){return new e(t)},e.prototype.getPools=function(){return this.pools||(this.pools=new d.ContainerPool,this.createDefaultContainer()),this.pools},e.prototype.createContainer=function(){return this.getContainerBuilder().create()},e.prototype.getContainerBuilder=function(){return this.containerBuilder||(this.containerBuilder=this.createContainerBuilder()),this.containerBuilder},e.prototype.createContainerBuilder=function(){return new p.DefaultContainerBuilder},e.prototype.useConfiguration=function(t){p.isUndefined(t)&&(t=""),this.globalConfig=null;var e=this.configs.indexOf(t);return 0<=e&&this.configs.splice(e,1),this.configs.push(t),this},e.prototype.loadConfig=function(t,e){if(t.has(c.AppConfigureLoaderToken)){var n=t.resolve(c.AppConfigureLoaderToken,{baseURL:this.baseURL,container:t});return n.load(e)}if(e){var r=t.getBuilder();return r.loader.load([e]).then(function(t){return t.length?t[0]:null})}return Promise.resolve(null)},e.prototype.use=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this.globalModules=this.globalModules.concat(t),this.inited=!1,this},e.prototype.provider=function(t,e){return this.providers.set(t,e),this},e.prototype.build=function(r,o,i){return f.__awaiter(this,void 0,void 0,function(){var e,n;return f.__generator(this,function(t){switch(t.label){case 0:return[4,this.load(r,o)];case 1:return e=t.sent(),(n=this.getBuilder(e))?[4,n.build(r,o,i)]:[3,3];case 2:return[2,t.sent()];case 3:return[4,a.prototype.build.call(this,r,o,i)];case 4:return[2,t.sent()]}})})},e.prototype.bootstrap=function(r,o,i){return f.__awaiter(this,void 0,void 0,function(){var e,n;return f.__generator(this,function(t){switch(t.label){case 0:return[4,this.load(r,o)];case 1:return e=t.sent(),(n=this.getBuilder(e))?[4,n.bootstrap(r,e,i)]:[3,3];case 2:return[2,t.sent()];case 3:return[4,a.prototype.bootstrap.call(this,r,e,i)];case 4:return[2,t.sent()]}})})},e.prototype.getBuilder=function(t){var n,e=t.config,r=t.container;e&&(p.isClass(e.builder)&&(r.has(e.builder)||r.register(e.builder)),p.isToken(e.builder)?n=r.resolve(e.builder):e.builder instanceof I.ModuleBuilder&&(n=e.builder));var o=t.token;return!n&&o&&r.getTokenExtendsChain(o).forEach(function(t){if(n)return!1;var e=new I.InjectModuleBuilderToken(t);return r.has(e)&&(n=r.get(e)),!0}),n||(n=this.getDefaultBuilder(r)),n||this},e.prototype.getDefaultBuilder=function(t){return t.has(I.DefaultModuleBuilderToken)?t.resolve(I.DefaultModuleBuilderToken):null},e.prototype.getParentContainer=function(r){return f.__awaiter(this,void 0,void 0,function(){var e,n;return f.__generator(this,function(t){switch(t.label){case 0:return e=this.getPools().getDefault(),[4,this.getGlobalConfig(e)];case 1:return n=t.sent(),this.inited||(this.registerExts(e,n),this.bindAppConfig(n),e.bindProvider(c.AppConfigureToken,n),this.events.emit(o.onRootContainerInited,e),this.inited=!0),[4,a.prototype.getParentContainer.call(this,r)];case 2:return[2,t.sent()]}})})},e.prototype.getGlobalConfig=function(r){return f.__awaiter(this,void 0,void 0,function(){var e,n=this;return f.__generator(this,function(t){switch(t.label){case 0:return this.globalConfig?[3,3]:[4,this.getDefaultConfig(r)];case 1:return e=(e=t.sent())||{},this.configs.length<1&&this.configs.push(""),[4,Promise.all(this.configs.map(function(t){return p.isString(t)?n.loadConfig(r,t):t}))];case 2:t.sent().forEach(function(t){t&&p.lang.assign(e,t)}),this.globalConfig=e,t.label=3;case 3:return[2,this.globalConfig]}})})},e.prototype.createDefaultContainer=function(){var t=this,e=this.createContainer();e.register(M.BootModule),this.pools.setDefault(e);var n=e.getBuilder().getInjectorChain(e);return n.first(e.resolve(I.DIModuleInjectorToken)),e.bindProvider(d.ContainerPoolToken,function(){return t.getPools()}),this.events.emit(o.onRootContainerCreated,e),e},e.prototype.registerExts=function(r,o){return f.__awaiter(this,void 0,void 0,function(){var e,n=this;return f.__generator(this,function(t){switch(t.label){case 0:return this.globalModules.length?(e=this.globalModules,[4,r.loadModule.apply(r,e)]):[3,2];case 1:t.sent(),t.label=2;case 2:return this.providers.forEach(function(t,e){r.bindProvider(e,t)}),this.customRegs.length?[4,Promise.all(this.customRegs.map(function(e){return f.__awaiter(n,void 0,void 0,function(){return f.__generator(this,function(t){switch(t.label){case 0:return[4,e(r,o,this)];case 1:return[2,t.sent()]}})})}))]:[3,4];case 3:t.sent(),t.label=4;case 4:return[2,r]}})})},e.prototype.bindAppConfig=function(t){return this.baseURL&&(t.baseURL=this.baseURL),t},e.prototype.getDefaultConfig=function(e){return f.__awaiter(this,void 0,void 0,function(){return f.__generator(this,function(t){return e.has(c.DefaultConfigureToken)?[2,e.resolve(c.DefaultConfigureToken)]:[2,{}]})})},e.classAnnations={name:"DefaultApplicationBuilder",params:{constructor:["baseURL"],create:["baseURL"],getPools:[],createContainer:[],getContainerBuilder:[],createContainerBuilder:[],useConfiguration:["config"],loadConfig:["container","src"],use:["modules"],provider:["provide","provider"],build:["token","env","data"],bootstrap:["token","env","data"],getBuilder:["injmdl"],getDefaultBuilder:["container"],getParentContainer:["env"],getGlobalConfig:["container"],createDefaultContainer:[],registerExts:["container","config"],bindAppConfig:["config"],getDefaultConfig:["container"]}},e}(I.ModuleBuilder);e.DefaultApplicationBuilder=r});e(j),j.ApplicationEvents,j.DefaultApplicationBuilder;var x=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.ApplicationBuilderToken=new p.InjectToken("DI_AppBuilder")});e(x),x.ApplicationBuilderToken;var C=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),f.__exportStar(c,e),f.__exportStar(j,e),f.__exportStar(x,e)});return e(C),e(n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),f.__exportStar(s,e),f.__exportStar(C,e),f.__exportStar(y,e),f.__exportStar(I,e),f.__exportStar(m,e),f.__exportStar(d,e),f.__exportStar(M,e)}))}(u,l,n,r)});e(d);var f=s(function(t,e){function n(e,n,r,o,i){return l.createClassDecorator("Task",function(t){o&&o(t),t.next({match:function(t){return l.isString(t)||l.isObject(t)&&t instanceof l.Registration},setMetadata:function(t,e){l.isString(e)&&(t.name=e),t.provide=e}}),t.next({match:function(t){return l.isString(t)||l.isToken(t)},setMetadata:function(t,e){l.isString(e)?t.name=e:t.annotationBuilder=e}}),t.next({match:function(t){return l.isString(t)},setMetadata:function(t,e){t.name=e}})},function(t){(i&&(t=i(t)),!t.name&&l.isClass(t.type))&&(/^[a-z]$/.test(t.type.name)&&t.type.classAnnations?t.name=t.type.classAnnations.name:t.name=t.type.name);return l.isUndefined(t.provide)&&(t.provide=t.name),r&&(l.isString(t.provide)&&(t.provide=new l.Registration(r,t.provide)),t.activity&&t.task||(t.activity=r)),t.decorType=e,n&&!t.annotationBuilder&&(t.annotationBuilder=n),t})}Object.defineProperty(e,"__esModule",{value:!0}),e.createTaskDecorator=n,e.Task=n("Task")});e(f);f.createTaskDecorator,f.Task;var p=s(function(t,e){function n(t,e,n,r,o){return d.createDIModuleDecorator(t,e,n,function(t){r&&r(t),t.next({match:function(t){return t&&(l.isString(t)||l.isObject(t)&&t instanceof l.Registration)},setMetadata:function(t,e){l.isString(e)?t.name=e:t.provide=e}}),t.next({match:function(t){return l.isString(t)||l.isToken(t)},setMetadata:function(t,e){l.isString(e)?t.name=e:t.annotationBuilder=e}}),t.next({match:function(t){return l.isString(t)},setMetadata:function(t,e){t.name=e}})},o)}Object.defineProperty(e,"__esModule",{value:!0}),e.createWorkflowDecorator=n,e.Workflow=n("Workflow")});e(p);p.createWorkflowDecorator,p.Workflow;var v=s(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),u.__exportStar(f,e),u.__exportStar(p,e)});e(v);var h=s(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(t){return e.call(this,"ActivityContext",t)||this}return u.__extends(t,e),t.classAnnations={name:"InjectContextToken",params:{constructor:["desc"]}},t}(l.Registration);e.InjectContextToken=n,e.ContextToken=new n("")});e(h);h.InjectContextToken,h.ContextToken;var _=s(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){}return t.prototype.onActivityInit=function(t){return u.__awaiter(this,void 0,void 0,function(){return u.__generator(this,function(t){return[2]})})},t.prototype.run=function(t,e){return Promise.resolve(t)},t.prototype.toExpression=function(t,e){return this.context.builder.toExpression(t,e||this)},t.prototype.toActivity=function(t,e,n,r,o){return this.context.builder.toActivity(t,o||this,e,n,r)},t.prototype.buildActivity=function(t){return this.context.builder.buildByConfig(t,this.id)},t.classAnnations={name:"Activity",params:{constructor:[],onActivityInit:["config"],run:["data","execute"],toExpression:["exptype","target"],toActivity:["exptype","isRightActivity","toConfig","valify","target"],buildActivity:["config"]}},u.__decorate([l.Inject(h.ContextToken),u.__metadata("design:type",Object)],t.prototype,"context",void 0),t=u.__decorate([v.Task,u.__metadata("design:paramtypes",[])],t)}();e.Activity=n});e(_);_.Activity;var y=s(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(t){return e.call(this,t)||this}return u.__extends(t,e),t.classAnnations={name:"InjectAcitityBuilderToken",params:{constructor:["type"]}},t}(d.InjectAnnotationBuilder);e.InjectAcitityBuilderToken=n,e.ActivityBuilderToken=new n(_.Activity)});e(y);y.InjectAcitityBuilderToken,y.ActivityBuilderToken;var g=s(function(t,e){var n;Object.defineProperty(e,"__esModule",{value:!0}),e.ActivityRunnerToken=new d.InjectServiceToken(_.Activity),(n=e.RunState||(e.RunState={}))[n.init=0]="init",n[n.running=1]="running",n[n.pause=2]="pause",n[n.stop=3]="stop",n[n.complete=4]="complete"});e(g);g.ActivityRunnerToken,g.RunState;var A=s(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,n){this.token=t,this.config=e,this.instance=n,this._result=new o.BehaviorSubject(null),this.stateChanged=new o.BehaviorSubject(g.RunState.init)}return Object.defineProperty(t.prototype,"activity",{get:function(){return this.token},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"configure",{get:function(){return this.config},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"result",{get:function(){return this._result.filter(function(t){return!t})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resultValue",{get:function(){return this._resultValue},enumerable:!0,configurable:!0}),t.prototype.start=function(n){return u.__awaiter(this,void 0,void 0,function(){var e=this;return u.__generator(this,function(t){switch(t.label){case 0:return[4,this.instance.run(n).then(function(t){return e.state=g.RunState.complete,e.stateChanged.next(e.state),e._resultValue=t,e._result.next(t),t})];case 1:return[2,t.sent()]}})})},t.prototype.saveState=function(t){this._currState=t},t.prototype.stop=function(){return u.__awaiter(this,void 0,void 0,function(){return u.__generator(this,function(t){return this.state=g.RunState.stop,this.stateChanged.next(this.state),[2]})})},t.prototype.pause=function(){return u.__awaiter(this,void 0,void 0,function(){return u.__generator(this,function(t){return this.state=g.RunState.pause,this.stateChanged.next(this.state),[2]})})},t.classAnnations={name:"ActivityRunner",params:{constructor:["token","config","instance"],start:["data"],saveState:["state"],stop:[],pause:[]}},u.__decorate([l.Inject(l.ContainerToken),u.__metadata("design:type",Object)],t.prototype,"container",void 0),t=u.__decorate([v.Workflow(g.ActivityRunnerToken),u.__metadata("design:paramtypes",[Object,Object,Object])],t)}();e.ActivityRunner=n});e(A);A.ActivityRunner;var k=s(function(t,e){function n(t){return t instanceof A.ActivityRunner}Object.defineProperty(e,"__esModule",{value:!0}),e.isActivityRunner=n,e.isActivityType=function(t,e){return void 0===e&&(e=!0),!(!t||n(t)||l.isString(t)||!l.isToken(t)&&(!l.isMetadataObject(t)||e&&!(t.activity||t.task||t.bootstrap)))}});e(k);k.isActivityRunner,k.isActivityType;var b=s(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(t){return e.call(this,"Activity",t)||this}return u.__extends(t,e),t.classAnnations={name:"InjectAcitityToken",params:{constructor:["desc"]}},t}(l.Registration);e.InjectAcitityToken=n,e.ActivityToken=new n("")});e(b);b.InjectAcitityToken,b.ActivityToken;var T=s(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(i){function t(){return null!==i&&i.apply(this,arguments)||this}return u.__extends(t,i),t.prototype.build=function(t,e,n){return i.prototype.build.call(this,t,e,n)},t.prototype.buildByConfig=function(t,e){return i.prototype.buildByConfig.call(this,t,e)},t.prototype.createInstance=function(n,r,o){return u.__awaiter(this,void 0,void 0,function(){var e;return u.__generator(this,function(t){switch(t.label){case 0:return l.isString(n)&&(n=this.traslateStrToken(n)),[4,i.prototype.createInstance.call(this,n,r,o)];case 1:return(e=t.sent())?(l.isString(o)&&(e.id=o),l.isFunction(e.onActivityInit)?[4,Promise.resolve(e.onActivityInit(r))]:[3,3]):[2,null];case 2:t.sent(),t.label=3;case 3:return[2,e]}})})},t.prototype.buildStrategy=function(e,n,t){return u.__awaiter(this,void 0,void 0,function(){return u.__generator(this,function(t){return n.name&&(e.name=n.name),e.config=n,[2,e]})})},t.prototype.getDefaultAcitvity=function(){return _.Activity},t.prototype.getType=function(t){var e=t.activity||t.task||t.token||t.type;return l.isString(e)&&(e=this.traslateStrToken(e)),e},t.prototype.getDecorator=function(){return v.Task.toString()},t.prototype.resolveToken=function(t,e){var n=this.container.resolve(t);return n.id=e,n},t.prototype.traslateStrToken=function(t){var e=new b.InjectAcitityToken(t);return this.container.has(e)?e:t},t.prototype.toExpression=function(e,n){return u.__awaiter(this,void 0,void 0,function(){return u.__generator(this,function(t){switch(t.label){case 0:return k.isActivityType(e)?[4,this.buildByConfig(e,n.id)]:[3,2];case 1:return[2,t.sent()];case 2:return[2,e]}})})},t.prototype.toActivity=function(o,i,a,s,c){return u.__awaiter(this,void 0,void 0,function(){var e,n,r;return u.__generator(this,function(t){switch(t.label){case 0:return k.isActivityType(o,!c)?c?[4,this.buildByConfig(l.isToken(o)?o:c(o),i.id)]:[3,2]:[3,5];case 1:return e=t.sent(),[3,4];case 2:return[4,this.buildByConfig(o,i.id)];case 3:e=t.sent(),t.label=4;case 4:return[3,6];case 5:e=o,t.label=6;case 6:return a(e)?[2,e]:l.isString(e)?(n=e,[3,9]):[3,7];case 7:return[4,i.context.exec(i,e)];case 8:n=t.sent(),t.label=9;case 9:return r=s(n),c&&(r=c(r)),r?[4,this.buildByConfig(r,i.id)]:[3,11];case 10:return e=t.sent(),[3,12];case 11:e=null,t.label=12;case 12:return[2,e]}})})},t.classAnnations={name:"ActivityBuilder",params:{build:["token","config","data"],buildByConfig:["activity","data"],createInstance:["token","config","uuid"],buildStrategy:["activity","config","container"],getDefaultAcitvity:[],getType:["config"],getDecorator:[],resolveToken:["token","uuid"],traslateStrToken:["token"],toExpression:["exptype","target"],toActivity:["exptype","target","isRightActivity","toConfig","valify"]}},t=u.__decorate([l.Injectable(y.ActivityBuilderToken)],t)}(d.AnnotationBuilder);e.ActivityBuilder=n});e(T);T.ActivityBuilder;var m=s(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u.__extends(e,t),e.classAnnations={name:"ExpressionActivity",params:{}},e=u.__decorate([v.Task],e)}(_.Activity);e.ExpressionActivity=n;var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u.__extends(e,t),e.classAnnations={name:"AssignActivity",params:{}},e=u.__decorate([v.Task],e)}(_.Activity);e.AssignActivity=r});e(m);m.ExpressionActivity,m.AssignActivity;var w=s(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){}return t.prototype.getContainer=function(){return this.container},t.prototype.getRootPath=function(){return(this.getContainer().get(d.AppConfigureToken)||{}).baseURL||"."},t.prototype.getEnvArgs=function(){return{}},t.prototype.to=function(t,e){return l.isFunction(t)?l.isClass(t)?t:t(this,e):t},t.prototype.exec=function(t,e,n){return l.isFunction(e)?e(t,n):l.isPromise(e)?e:e instanceof _.Activity?e.run(n,t):e instanceof A.ActivityRunner?e.start(n):Promise.resolve(e)},t.prototype.isTask=function(t){return l.hasOwnClassMetadata(v.Task,t)},t.classAnnations={name:"Context",params:{constructor:[],getContainer:[],getRootPath:[],getEnvArgs:[],to:["target","config"],exec:["target","expression","data"],isTask:["task"]}},u.__decorate([l.Inject(l.ContainerToken),u.__metadata("design:type",Object)],t.prototype,"container",void 0),u.__decorate([l.Inject(y.ActivityBuilderToken),u.__metadata("design:type",T.ActivityBuilder)],t.prototype,"builder",void 0),t=u.__decorate([l.Singleton(h.ContextToken),u.__metadata("design:paramtypes",[])],t)}();e.Context=n});e(w);w.Context;var I=s(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.UUIDToken=new l.InjectToken("uuid_factory");var n=function(){function t(){}return t.prototype.generate=function(){return this.randomS4()+this.randomS4()+"-"+this.randomS4()+"-"+this.randomS4()+"-"+this.randomS4()+"-"+this.randomS4()+this.randomS4()+this.randomS4()},t.prototype.randomS4=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},t.classAnnations={name:"RandomUUIDFactory",params:{constructor:[],generate:[],randomS4:[]}},t=u.__decorate([l.Singleton(e.UUIDToken),u.__metadata("design:paramtypes",[])],t)}();e.RandomUUIDFactory=n});e(I);I.UUIDToken,I.RandomUUIDFactory;var M=s(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),u.__exportStar(y,e),u.__exportStar(T,e),u.__exportStar(b,e),u.__exportStar(_,e),u.__exportStar(m,e),u.__exportStar(k,e),u.__exportStar(v,e),u.__exportStar(h,e),u.__exportStar(w,e),u.__exportStar(g,e),u.__exportStar(A,e),u.__exportStar(I,e)});e(M);var j=s(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.DelayActivityToken=new M.InjectAcitityToken("delay");var n=function(r){function t(){return null!==r&&r.apply(this,arguments)||this}return u.__extends(t,r),t.prototype.onActivityInit=function(n){return u.__awaiter(this,void 0,void 0,function(){var e;return u.__generator(this,function(t){switch(t.label){case 0:return[4,r.prototype.onActivityInit.call(this,n)];case 1:return t.sent(),[4,(e=this).toExpression(n.delay,this)];case 2:return e.delay=t.sent(),[2]}})})},t.prototype.run=function(o){return u.__awaiter(this,void 0,void 0,function(){var e,n,r;return u.__generator(this,function(t){switch(t.label){case 0:return[4,this.context.exec(this,this.delay,o)];case 1:return e=t.sent(),n=new l.Defer,r=setTimeout(function(){n.resolve(o),clearTimeout(r)},e),[4,n.promise];case 2:return[2,t.sent()]}})})},t.classAnnations={name:"DelayActivity",params:{onActivityInit:["config"],run:["data"]}},t=u.__decorate([M.Task(e.DelayActivityToken)],t)}(M.Activity);e.DelayActivity=n});e(j);j.DelayActivityToken,j.DelayActivity;var x=s(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.IntervalActivityToken=new M.InjectAcitityToken("interval");var n=function(o){function t(){return null!==o&&o.apply(this,arguments)||this}return u.__extends(t,o),t.prototype.onActivityInit=function(r){return u.__awaiter(this,void 0,void 0,function(){var e,n;return u.__generator(this,function(t){switch(t.label){case 0:return[4,o.prototype.onActivityInit.call(this,r)];case 1:return t.sent(),[4,(e=this).toExpression(r.interval)];case 2:return e.interval=t.sent(),[4,(n=this).buildActivity(r.body)];case 3:return n.body=t.sent(),[2]}})})},t.prototype.run=function(o){return u.__awaiter(this,void 0,void 0,function(){var e,n,r=this;return u.__generator(this,function(t){switch(t.label){case 0:return[4,this.context.exec(this,this.interval,o)];case 1:return e=t.sent(),n=o,setInterval(function(){r.body.run(n)},e),[2,o]}})})},t.classAnnations={name:"IntervalActivity",params:{onActivityInit:["config"],run:["data"]}},t=u.__decorate([M.Task(e.IntervalActivityToken)],t)}(M.Activity);e.IntervalActivity=n});e(x);x.IntervalActivityToken,x.IntervalActivity;var C=s(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.DoWhileActivityToken=new M.InjectAcitityToken("dowhile");var n=function(o){function t(){return null!==o&&o.apply(this,arguments)||this}return u.__extends(t,o),t.prototype.onActivityInit=function(r){return u.__awaiter(this,void 0,void 0,function(){var e,n;return u.__generator(this,function(t){switch(t.label){case 0:return[4,o.prototype.onActivityInit.call(this,r)];case 1:return t.sent(),[4,(e=this).buildActivity(r.do)];case 2:return e.body=t.sent(),[4,(n=this).toExpression(r.while)];case 3:return n.condition=t.sent(),[2]}})})},t.prototype.run=function(r){return u.__awaiter(this,void 0,void 0,function(){var e,n;return u.__generator(this,function(t){switch(t.label){case 0:return[4,this.body.run(r)];case 1:return e=t.sent(),[4,this.context.exec(this,this.condition,e)];case 2:n=t.sent(),t.label=3;case 3:return n?[4,this.body.run(e||r)]:[3,6];case 4:return e=t.sent(),[4,this.context.exec(this,this.condition,e)];case 5:return n=t.sent(),[3,3];case 6:return[2,e]}})})},t.classAnnations={name:"DoWhileActivity",params:{onActivityInit:["config"],run:["data"]}},t=u.__decorate([M.Task(e.DoWhileActivityToken)],t)}(M.Activity);e.DoWhileActivity=n});e(C);C.DoWhileActivityToken,C.DoWhileActivity;var B=s(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.IfActivityToken=new M.InjectAcitityToken("if");var n=function(i){function t(){return null!==i&&i.apply(this,arguments)||this}return u.__extends(t,i),t.prototype.onActivityInit=function(o){return u.__awaiter(this,void 0,void 0,function(){var e,n,r;return u.__generator(this,function(t){switch(t.label){case 0:return[4,i.prototype.onActivityInit.call(this,o)];case 1:return t.sent(),[4,(e=this).buildActivity(o.ifBody)];case 2:return e.ifBody=t.sent(),[4,(n=this).toExpression(o.if)];case 3:return n.condition=t.sent(),o.elseBody?[4,(r=this).buildActivity(o.elseBody)]:[3,5];case 4:r.elseBody=t.sent(),t.label=5;case 5:return[2]}})})},t.prototype.run=function(e){return u.__awaiter(this,void 0,void 0,function(){return u.__generator(this,function(t){switch(t.label){case 0:return[4,this.context.exec(this,this.condition,e)];case 1:return t.sent()?[2,this.execIf(e)]:this.elseBody?[2,this.execElse(e)]:[2,Promise.resolve(e)]}})})},t.prototype.execIf=function(t){return this.ifBody.run(t)},t.prototype.execElse=function(t){return this.elseBody.run(t)},t.classAnnations={name:"IfActivity",params:{onActivityInit:["config"],run:["data"],execIf:["data"],execElse:["data"]}},t=u.__decorate([M.Task(e.IfActivityToken)],t)}(M.Activity);e.IfActivity=n});e(B);B.IfActivityToken,B.IfActivity;var D=s(function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.InvokeActivityToken=new M.InjectAcitityToken("invoke");var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u.__extends(e,t),e.prototype.run=function(e){return u.__awaiter(this,void 0,void 0,function(){return u.__generator(this,function(t){return[2,this.context.getContainer().invoke(this.targetType,this.target,this.args,{data:e})]})})},e.classAnnations={name:"InvokeActivity",params:{run:["data"]}},e=u.__decorate([M.Task(n.InvokeActivityToken)],e)}(M.Activity);n.InvokeActivity=e});e(D);D.InvokeActivityToken,D.InvokeActivity;var S=s(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.ParallelActivityToken=new M.InjectAcitityToken("parallel");var n=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.activites=[],t}var i;return u.__extends(t,n),(i=t).prototype.onActivityInit=function(e){return u.__awaiter(this,void 0,void 0,function(){return u.__generator(this,function(t){switch(t.label){case 0:return[4,n.prototype.onActivityInit.call(this,e)];case 1:return t.sent(),e.parallel&&e.parallel.length?[4,this.buildChildren(this,e.parallel)]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})},t.prototype.buildChildren=function(n,o){return u.__awaiter(this,void 0,void 0,function(){var e,r=this;return u.__generator(this,function(t){switch(t.label){case 0:return[4,Promise.all(o.map(function(n){return u.__awaiter(r,void 0,void 0,function(){var e;return u.__generator(this,function(t){switch(t.label){case 0:return[4,this.buildActivity(n)];case 1:return(e=t.sent())?e instanceof i&&!l.isToken(n)&&n.parallel&&n.parallel.length?[4,e.buildChildren(e,n.parallel)]:[3,3]:[2,null];case 2:t.sent(),t.label=3;case 3:return[2,e]}})})}))];case 1:return e=t.sent(),n.activites=e,[2,n]}})})},t.prototype.run=function(n,r){return u.__awaiter(this,void 0,void 0,function(){var e;return u.__generator(this,function(t){switch(t.label){case 0:return[4,this.before(n,r)];case 1:return e=t.sent(),[4,this.execute(e,r)];case 2:return e=t.sent(),[4,this.after(e,r)];case 3:return[2,e=t.sent()]}})})},t.prototype.before=function(e,t){return u.__awaiter(this,void 0,void 0,function(){return u.__generator(this,function(t){return[2,e]})})},t.prototype.execute=function(e,t){return Promise.all(this.activites.map(function(t){return t.run(e)}))},t.prototype.after=function(e,t){return u.__awaiter(this,void 0,void 0,function(){return u.__generator(this,function(t){return[2,e]})})},t.classAnnations={name:"ParallelActivity",params:{onActivityInit:["config"],buildChildren:["activity","configs"],run:["data","execute"],before:["data","execute"],execute:["data","execute"],after:["data","execute"]}},t=i=u.__decorate([M.Task(e.ParallelActivityToken)],t)}(M.Activity);e.ParallelActivity=n});e(S);S.ParallelActivityToken,S.ParallelActivity;var P=s(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.SequenceActivityToken=new M.InjectAcitityToken("sequence");var n=function(n){function t(){var t=n.call(this)||this;return t.activites=[],t}var i;return u.__extends(t,n),(i=t).prototype.onActivityInit=function(e){return u.__awaiter(this,void 0,void 0,function(){return u.__generator(this,function(t){switch(t.label){case 0:return[4,n.prototype.onActivityInit.call(this,e)];case 1:return t.sent(),e.sequence&&e.sequence.length?[4,this.buildChildren(this,e.sequence)]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})},t.prototype.buildChildren=function(n,o){return u.__awaiter(this,void 0,void 0,function(){var e,r=this;return u.__generator(this,function(t){switch(t.label){case 0:return[4,Promise.all(o.map(function(n){return u.__awaiter(r,void 0,void 0,function(){var e;return u.__generator(this,function(t){switch(t.label){case 0:return[4,this.buildActivity(n)];case 1:return(e=t.sent())?e instanceof i&&!l.isToken(n)&&n.sequence&&n.sequence.length?[4,e.buildChildren(e,n.sequence)]:[3,3]:[2,null];case 2:t.sent(),t.label=3;case 3:return[2,e]}})})}))];case 1:return e=t.sent(),n.activites=e,[2,n]}})})},t.prototype.run=function(n,r){return u.__awaiter(this,void 0,void 0,function(){var e;return u.__generator(this,function(t){switch(t.label){case 0:return[4,this.before(n,r)];case 1:return e=t.sent(),[4,this.execute(e,r)];case 2:return e=t.sent(),[4,this.after(e,r)];case 3:return[2,e=t.sent()]}})})},t.prototype.before=function(e,t){return u.__awaiter(this,void 0,void 0,function(){return u.__generator(this,function(t){return[2,e]})})},t.prototype.execute=function(t,e){var n=Promise.resolve(t);return this.activites.forEach(function(e){n=n.then(function(t){return e.run(t)})}),n},t.prototype.after=function(e,t){return u.__awaiter(this,void 0,void 0,function(){return u.__generator(this,function(t){return[2,e]})})},t.classAnnations={name:"SequenceActivity",params:{constructor:[],onActivityInit:["config"],buildChildren:["activity","configs"],run:["data","execute"],before:["data","execute"],execute:["data","execute"],after:["data","execute"]}},t=i=u.__decorate([M.Task(e.SequenceActivityToken),u.__metadata("design:paramtypes",[])],t)}(M.Activity);e.SequenceActivity=n});e(P);P.SequenceActivityToken,P.SequenceActivity;var O=s(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.SwitchActivityToken=new M.InjectAcitityToken("switch");var n=function(i){function t(){var t=null!==i&&i.apply(this,arguments)||this;return t.cases=new l.MapSet,t}return u.__extends(t,i),t.prototype.onActivityInit=function(o){return u.__awaiter(this,void 0,void 0,function(){var e,n,r=this;return u.__generator(this,function(t){switch(t.label){case 0:return[4,i.prototype.onActivityInit.call(this,o)];case 1:return t.sent(),[4,(e=this).toExpression(o.expression)];case 2:return e.expression=t.sent(),o.cases&&o.cases.length?[4,Promise.all(o.cases.map(function(n){return u.__awaiter(r,void 0,void 0,function(){var e;return u.__generator(this,function(t){switch(t.label){case 0:return[4,this.buildActivity(n.value)];case 1:return e=t.sent(),this.cases.set(n.key,e),[2,e]}})})}))]:[3,4];case 3:t.sent(),t.label=4;case 4:return o.defaultBody?[4,(n=this).buildActivity(o.defaultBody)]:[3,6];case 5:n.defaultBody=t.sent(),t.label=6;case 6:return[2]}})})},t.prototype.run=function(n){return u.__awaiter(this,void 0,void 0,function(){var e;return u.__generator(this,function(t){switch(t.label){case 0:return[4,this.context.exec(this,this.expression,n)];case 1:return e=t.sent(),!l.isUndefined(e)&&this.cases.has(e)?[2,this.cases.get(e).run(n)]:this.defaultBody?[2,this.defaultBody.run(n)]:[2,Promise.resolve(n)]}})})},t.classAnnations={name:"SwitchActivity",params:{onActivityInit:["config"],run:["data"]}},t=u.__decorate([M.Task(e.SwitchActivityToken)],t)}(M.Activity);e.SwitchActivity=n});e(O);O.SwitchActivityToken,O.SwitchActivity;var R=s(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.ThrowActivityToken=new M.InjectAcitityToken("throw");var n=function(r){function t(){return null!==r&&r.apply(this,arguments)||this}return u.__extends(t,r),t.prototype.onActivityInit=function(n){return u.__awaiter(this,void 0,void 0,function(){var e;return u.__generator(this,function(t){switch(t.label){case 0:return[4,r.prototype.onActivityInit.call(this,n)];case 1:return t.sent(),[4,(e=this).toExpression(n.exception)];case 2:return e.exception=t.sent(),[2]}})})},t.prototype.run=function(e){return u.__awaiter(this,void 0,void 0,function(){return u.__generator(this,function(t){switch(t.label){case 0:return[4,this.context.exec(this,this.exception,e)];case 1:throw t.sent()}})})},t.classAnnations={name:"ThrowActivity",params:{onActivityInit:["config"],run:["data"]}},t=u.__decorate([M.Task(e.ThrowActivityToken)],t)}(M.Activity);e.ThrowActivity=n});e(R);R.ThrowActivityToken,R.ThrowActivity;var E=s(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.TryCatchActivityToken=new M.InjectAcitityToken("trycatch");var n=function(a){function t(){var t=null!==a&&a.apply(this,arguments)||this;return t.catchs=[],t}return u.__extends(t,a),t.prototype.onActivityInit=function(i){return u.__awaiter(this,void 0,void 0,function(){var e,n,r,o=this;return u.__generator(this,function(t){switch(t.label){case 0:return[4,a.prototype.onActivityInit.call(this,i)];case 1:return t.sent(),[4,(e=this).buildActivity(i.try)];case 2:return e.try=t.sent(),i.catchs&&i.catchs.length?[4,Promise.all(i.catchs.map(function(t){return o.buildActivity(t)}))]:[3,4];case 3:n=t.sent(),this.catchs=n,t.label=4;case 4:return i.finally?[4,(r=this).buildActivity(i.finally)]:[3,6];case 5:r.finally=t.sent(),t.label=6;case 6:return[2]}})})},t.prototype.run=function(r){return u.__awaiter(this,void 0,void 0,function(){var n,e=this;return u.__generator(this,function(t){try{n=this.try.run(r),this.catchs.forEach(function(e){n=n.catch(function(t){return e.run(t)})}),this.finally&&n.then(function(t){return e.finally.run(t)})}catch(t){n=Promise.resolve(r),this.finally&&n.then(function(t){return e.finally.run(t)})}return[2,n]})})},t.classAnnations={name:"TryCatchActivity",params:{onActivityInit:["config"],run:["data"]}},t=u.__decorate([M.Task(e.TryCatchActivityToken)],t)}(_.Activity);e.TryCatchActivity=n});e(E);E.TryCatchActivityToken,E.TryCatchActivity;var U=s(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.WhileActivityToken=new M.InjectAcitityToken("while");var n=function(o){function t(){return null!==o&&o.apply(this,arguments)||this}return u.__extends(t,o),t.prototype.onActivityInit=function(r){return u.__awaiter(this,void 0,void 0,function(){var e,n;return u.__generator(this,function(t){switch(t.label){case 0:return[4,o.prototype.onActivityInit.call(this,r)];case 1:return t.sent(),[4,(e=this).buildActivity(r.body)];case 2:return e.body=t.sent(),[4,(n=this).toExpression(r.while)];case 3:return n.condition=t.sent(),[2]}})})},t.prototype.run=function(r){return u.__awaiter(this,void 0,void 0,function(){var e,n;return u.__generator(this,function(t){switch(t.label){case 0:return[4,this.context.exec(this,this.condition,r)];case 1:e=t.sent(),t.label=2;case 2:return e?[4,this.body.run(n||r)]:[3,5];case 3:return n=t.sent(),[4,this.context.exec(this,this.condition,n)];case 4:return e=t.sent(),[3,2];case 5:return[2,n]}})})},t.classAnnations={name:"WhileActivity",params:{onActivityInit:["config"],run:["data"]}},t=u.__decorate([M.Task(e.WhileActivityToken)],t)}(M.Activity);e.WhileActivity=n});e(U);U.WhileActivityToken,U.WhileActivity;var W=s(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),u.__exportStar(j,e),u.__exportStar(x,e),u.__exportStar(C,e),u.__exportStar(B,e),u.__exportStar(D,e),u.__exportStar(S,e),u.__exportStar(P,e),u.__exportStar(O,e),u.__exportStar(R,e),u.__exportStar(E,e),u.__exportStar(U,e)});e(W);var V=s(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){}return t.prototype.beforeRun=function(t){var e=this.getRunner(t.target);if(e)switch(e.saveState(t),e.state){case M.RunState.pause:throw new Error("workflow paused!");case M.RunState.stop:throw new Error("workflow stop!")}},t.prototype.afterRun=function(t){var e=this.getRunner(t.target);if(e)switch(e.saveState(t),e.state){case M.RunState.pause:throw new Error("workflow paused!");case M.RunState.stop:throw new Error("workflow stop!")}},t.prototype.getRunner=function(t){return t instanceof M.Activity&&t.id&&this.container.has(t.id)?this.container.resolve(t.id):null},t.classAnnations={name:"RunAspect",params:{constructor:[],beforeRun:["joinPoint"],afterRun:["joinPoint"],getRunner:["task"]}},u.__decorate([l.Inject(l.ContainerToken),u.__metadata("design:type",Object)],t.prototype,"container",void 0),u.__decorate([i.Before("execution(*.run)"),u.__metadata("design:type",Function),u.__metadata("design:paramtypes",[i.Joinpoint]),u.__metadata("design:returntype",void 0)],t.prototype,"beforeRun",null),u.__decorate([i.AfterReturning("execution(*.run)"),u.__metadata("design:type",Function),u.__metadata("design:paramtypes",[i.Joinpoint]),u.__metadata("design:returntype",void 0)],t.prototype,"afterRun",null),t=u.__decorate([i.Aspect({annotation:M.Task,singleton:!0}),u.__metadata("design:paramtypes",[])],t)}();e.RunAspect=n});e(V);V.RunAspect;var q=s(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),u.__exportStar(V,e)});e(q);var L=s(function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.WorkflowModuleValidateToken=new l.InjectModuleValidateToken(M.Workflow.toString());var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u.__extends(e,t),e.prototype.getDecorator=function(){return M.Workflow.toString()},e.classAnnations={name:"WorkflowModuleValidate",params:{getDecorator:[]}},e=u.__decorate([l.Singleton(n.WorkflowModuleValidateToken)],e)}(l.BaseModuelValidate);n.WorkflowModuleValidate=e,n.ActvityModuleValidateToken=new l.InjectModuleValidateToken(M.Task.toString());var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u.__extends(e,t),e.prototype.getDecorator=function(){return M.Task.toString()},e.classAnnations={name:"ActvityModuleValidate",params:{getDecorator:[]}},e=u.__decorate([l.Singleton(n.ActvityModuleValidateToken)],e)}(l.BaseModuelValidate);n.ActvityModuleValidate=r});e(L);L.WorkflowModuleValidateToken,L.WorkflowModuleValidate,L.ActvityModuleValidateToken,L.ActvityModuleValidate;var F=s(function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.WorkflowModuleInjectorToken=new l.InjectModuleInjectorToken(M.Workflow.toString());var e=function(e){function t(t){return e.call(this,t)||this}return u.__extends(t,e),t.classAnnations={name:"WorkflowModuleInjector",params:{constructor:["validate"]}},t=u.__decorate([l.Injectable(n.WorkflowModuleInjectorToken),u.__param(0,l.Inject(L.WorkflowModuleValidateToken)),u.__metadata("design:paramtypes",[Object])],t)}(d.DIModuleInjector);n.WorkflowModuleInjector=e,n.ActivityModuleInjectorToken=new l.InjectModuleInjectorToken(M.Task.toString());var r=function(e){function t(t){return e.call(this,t)||this}return u.__extends(t,e),t.prototype.importModule=function(r,o){return u.__awaiter(this,void 0,void 0,function(){var e,n;return u.__generator(this,function(t){switch(t.label){case 0:return r.register(o),e=this.getMetaConfig(o,r),[4,this.registerConfgureDepds(r,e)];case 1:return t.sent(),n=new d.InjectedModule(o,e,r),r.bindProvider(new d.InjectedModuleToken(o),n),[2,n]}})})},t.classAnnations={name:"ActivityModuleInjector",params:{constructor:["validate"],importModule:["container","type"]}},t=u.__decorate([l.Injectable(n.ActivityModuleInjectorToken),u.__param(0,l.Inject(L.WorkflowModuleValidateToken)),u.__metadata("design:paramtypes",[Object])],t)}(d.DIModuleInjector);n.ActivityModuleInjector=r});e(F);F.WorkflowModuleInjectorToken,F.WorkflowModuleInjector,F.ActivityModuleInjectorToken,F.ActivityModuleInjector;var K=s(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.WorkflowBuilderToken=new d.InjectModuleBuilderToken(M.Activity);var n=function(i){function t(){return null!==i&&i.apply(this,arguments)||this}return u.__extends(t,i),t.prototype.bootstrap=function(n,r,o){return u.__awaiter(this,void 0,void 0,function(){var e;return u.__generator(this,function(t){switch(t.label){case 0:return[4,this.load(n,r)];case 1:return e=t.sent(),console.log(e),o=o||this.createUUID(e.container),[4,i.prototype.bootstrap.call(this,n,e,o)];case 2:return[2,t.sent()]}})})},t.prototype.createUUID=function(t){return t.has(M.UUIDToken)||t.register(M.RandomUUIDFactory),t.get(M.UUIDToken).generate()},t.prototype.getBootTyp=function(t){return t.activity||t.task||i.prototype.getBootType.call(this,t)},t.prototype.getDefaultService=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return t.resolve.apply(t,[M.ActivityRunnerToken].concat(e))},t.classAnnations={name:"DefaultWorkflowBuilder",params:{bootstrap:["activity","env","workflowId"],createUUID:["container"],getBootTyp:["config"],getDefaultService:["container","providers"]}},t=u.__decorate([l.Singleton(e.WorkflowBuilderToken)],t)}(d.ModuleBuilder);e.DefaultWorkflowBuilder=n});e(K);K.WorkflowBuilderToken,K.DefaultWorkflowBuilder;var G=s(function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ActivityMetaAccessorToken=new d.InjectMetaAccessorToken(M.Activity);var e=function(t){function e(){return t.call(this,M.Task.toString())||this}return u.__extends(e,t),e.classAnnations={name:"ActivityMetaAccessor",params:{constructor:[]}},e=u.__decorate([l.Injectable(n.ActivityMetaAccessorToken),u.__metadata("design:paramtypes",[])],e)}(d.MetaAccessor);n.ActivityMetaAccessor=e});e(G);G.ActivityMetaAccessorToken,G.ActivityMetaAccessor;var z=s(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),u.__exportStar(L,e),u.__exportStar(F,e),u.__exportStar(K,e),u.__exportStar(G,e)});e(z);var J=s(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.container=t}return t.prototype.setup=function(){var t=this.container,e=t.getLifeScope();e.registerDecorator(M.Workflow,l.CoreActions.bindProvider,l.CoreActions.cache,l.CoreActions.componentBeforeInit,l.CoreActions.componentInit,l.CoreActions.componentAfterInit),e.registerDecorator(M.Task,l.CoreActions.bindProvider,l.CoreActions.cache,l.CoreActions.componentBeforeInit,l.CoreActions.componentInit,l.CoreActions.componentAfterInit),t.register(M.ActivityBuilder).register(M.ActivityRunner).register(M.Context).register(q.RunAspect).register(M.Activity).use(W).use(z)},t.classAnnations={name:"CoreModule",params:{constructor:["container"],setup:[]}},t=u.__decorate([l.IocExt("setup"),u.__param(0,l.Inject(l.ContainerToken)),u.__metadata("design:paramtypes",[Object])],t)}();e.CoreModule=n});e(J);J.CoreModule;var $=s(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.baseURL=t}return t.prototype.getContainer=function(){return this.container||(this.container=this.getBuilder().getPools().getDefault()),this.container},t.prototype.getBuilder=function(){return this.builder||(this.builder=this.createAppBuilder(),this.builder.events.on(d.ApplicationEvents.onRootContainerCreated,function(t){t.register(z.DefaultWorkflowBuilder).register(z.WorkflowModuleValidate).register(z.WorkflowModuleInjector).register(z.ActvityModuleValidate).register(z.ActivityModuleInjector);var e=t.getBuilder().getInjectorChain(t);e.first(t.resolve(z.ActivityModuleInjectorToken)),e.first(t.resolve(z.WorkflowModuleInjectorToken))}),this.builder.use(i.AopModule).use(a.LogModule).use(J.CoreModule).provider(d.DefaultAnnotationBuilderToken,M.ActivityBuilderToken).provider(d.DefaultServiceToken,M.ActivityRunnerToken).provider(d.DefaultModuleBuilderToken,z.WorkflowBuilderToken).provider(d.DefaultMetaAccessorToken,z.ActivityMetaAccessorToken)),this.builder},t.prototype.createAppBuilder=function(){return new d.DefaultApplicationBuilder(this.baseURL)},t.prototype.useConfiguration=function(t){return this.getBuilder().useConfiguration(t),this},t.prototype.use=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return(t=this.getBuilder()).use.apply(t,e),this},t.prototype.provider=function(t,e){return this.getBuilder().provider(t,e),this},t.prototype.useLog=function(t){return l.hasClassMetadata(i.Aspect,t)?this.getBuilder().use(t):console.error("logAspect param is not right aspect"),this},t.prototype.getWorkflow=function(t){return this.getContainer().resolve(t)},t.prototype.createActivity=function(r,o){return u.__awaiter(this,void 0,void 0,function(){var e,n;return u.__generator(this,function(t){switch(t.label){case 0:return o=o||this.createUUID(),l.isToken(r)?e=r:((e=r||{}).id=o,e.builder=e.builder||z.WorkflowBuilderToken,e.annotationBuilder=e.annotationBuilder||M.ActivityBuilderToken),[4,this.getBuilder().bootstrap(e,null,o)];case 1:return n=t.sent(),this.getContainer().bindProvider(o,n),[2,n]}})})},t.prototype.createUUID=function(){var t=this.getContainer();return t.has(M.UUIDToken)||t.register(M.RandomUUIDFactory),t.get(M.UUIDToken).generate()},t.prototype.bootstrap=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return u.__awaiter(this,void 0,void 0,function(){var e;return u.__generator(this,function(t){switch(t.label){case 0:return e=1<n.length?{sequence:n,task:W.SequenceActivity}:l.lang.first(n),[4,this.createActivity(e)];case 1:return[2,t.sent()]}})})},t.classAnnations={name:"DefaultTaskContainer",params:{constructor:["baseURL"],getContainer:[],getBuilder:[],createAppBuilder:[],useConfiguration:["config"],use:["modules"],provider:["provide","provider"],useLog:["logAspect"],getWorkflow:["workflowId"],createActivity:["activity","workflowId"],createUUID:[],bootstrap:["activites"]}},t}();e.DefaultTaskContainer=n});e($);$.DefaultTaskContainer;var N=s(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.pick=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r={};return t.forEach(function(t){r[t]=e[t]}),r}});e(N);N.pick;var H=s(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),u.__exportStar(N,e)});return e(H),e(s(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),u.__exportStar(c,e),u.__exportStar($,e),u.__exportStar(z,e),u.__exportStar(H,e),u.__exportStar(M,e),u.__exportStar(q,e),u.__exportStar(W,e),u.__exportStar(J,e)}))});